{"version":3,"file":"comboselect.js","sources":["../src/utils/Validators.ts","../src/core/Config.ts","../src/core/EventEmitter.ts","../src/core/constants.ts","../src/services/DataService.ts","../src/services/SearchService.ts","../src/utils/DOMHelpers.ts","../src/services/RenderService.ts","../src/utils/Debounce.ts","../src/components/Input.ts","../src/components/Dropdown.ts","../src/components/Tag.ts","../src/components/TagList.ts","../src/core/ComboSelect.ts","../src/web-component/ComboSelectElement.ts"],"sourcesContent":["import type { ComboSelectConfig } from '../types/index';\r\n\r\nexport class Validators {\r\n  static validateConfig(config: Partial<ComboSelectConfig>): void {\r\n    if (config.maxItems !== undefined && config.maxItems < 1) {\r\n      throw new Error('maxItems must be greater than 0');\r\n    }\r\n\r\n    if (config.minChars !== undefined && config.minChars < 0) {\r\n      throw new Error('minChars cannot be negative');\r\n    }\r\n\r\n    if (config.debounceDelay !== undefined && config.debounceDelay < 0) {\r\n      throw new Error('debounceDelay cannot be negative');\r\n    }\r\n\r\n    if (config.incrementValueSize !== undefined && config.incrementValueSize < 1) {\r\n      throw new Error('incrementValueSize must be greater than 0');\r\n    }\r\n\r\n    if (!config.autocompleteUrl && !config.dataSource) {\r\n      console.warn('Neither autocompleteUrl nor dataSource provided. ComboSelect will work in manual mode.');\r\n    }\r\n\r\n    if (config.autocompleteUrl && config.dataSource) {\r\n      console.warn('Both autocompleteUrl and dataSource provided. dataSource will take precedence.');\r\n    }\r\n  }\r\n\r\n  static validateUrl(url: string): boolean {\r\n    try {\r\n      new URL(url);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}","import type { ComboSelectConfig } from '../types/index';\r\nimport { Validators } from '@utils/Validators';\r\n\r\nexport class Config {\r\n  private config: ComboSelectConfig;\r\n\r\n  private static readonly DEFAULT_CONFIG: ComboSelectConfig = {\r\n    placeholder: 'Sélectionner...',\r\n    minChars: 1,\r\n    debounceDelay: 300,\r\n    httpMethod: 'GET',\r\n    searchParam: 'q',\r\n    labelSuggestion: 'label',\r\n    valueSuggestion: null,\r\n    multiple: false,\r\n    closeOnSelect: true,\r\n    clearOnSelect: false,\r\n    allowCreate: false,\r\n    httpHeaders: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  };\r\n\r\n  constructor(userConfig: Partial<ComboSelectConfig>) {\r\n    Validators.validateConfig(userConfig);\r\n    \r\n    this.config = {\r\n      ...Config.DEFAULT_CONFIG,\r\n      ...userConfig,\r\n    };\r\n  }\r\n\r\n  get<K extends keyof ComboSelectConfig>(key: K): ComboSelectConfig[K] {\r\n    return this.config[key];\r\n  }\r\n\r\n  getAll(): Readonly<ComboSelectConfig> {\r\n    return Object.freeze({ ...this.config });\r\n  }\r\n\r\n  update(updates: Partial<ComboSelectConfig>): void {\r\n    Validators.validateConfig(updates);\r\n    this.config = {\r\n      ...this.config,\r\n      ...updates,\r\n    };\r\n  }\r\n}","import type { ComboSelectEvent } from '../types/index';\r\n\r\nexport class EventEmitter {\r\n  private events: Map<ComboSelectEvent, Set<(...args: any[]) => void>>;\r\n\r\n  constructor() {\r\n    this.events = new Map();\r\n  }\r\n\r\n  on(event: ComboSelectEvent, callback: (...args: any[]) => void): void {\r\n    if (!this.events.has(event)) {\r\n      this.events.set(event, new Set());\r\n    }\r\n    this.events.get(event)!.add(callback);\r\n  }\r\n\r\n  off(event: ComboSelectEvent, callback: (...args: any[]) => void): void {\r\n    const callbacks = this.events.get(event);\r\n    if (callbacks) {\r\n      callbacks.delete(callback);\r\n    }\r\n  }\r\n\r\n  emit(event: ComboSelectEvent, ...args: any[]): void {\r\n    const callbacks = this.events.get(event);\r\n    if (callbacks) {\r\n      callbacks.forEach((callback) => {\r\n        try {\r\n          callback(...args);\r\n        } catch (error) {\r\n          console.error(`Error in event handler for \"${event}\":`, error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.events.clear();\r\n  }\r\n}","/**\r\n * Constantes globales pour ComboSelect\r\n * @packageDocumentation\r\n */\r\n\r\n/**\r\n * Valeurs par défaut de configuration\r\n * @public\r\n */\r\nexport const DEFAULTS = {\r\n    /** Placeholder par défaut */\r\n    PLACEHOLDER: 'Sélectionner...',\r\n    \r\n    /** Nombre minimum de caractères avant recherche */\r\n    MIN_CHARS: 1,\r\n    \r\n    /** Délai de debounce en millisecondes */\r\n    DEBOUNCE_DELAY: 300,\r\n    \r\n    /** Méthode HTTP par défaut */\r\n    HTTP_METHOD: 'GET' as const,\r\n    \r\n    /** Paramètre de recherche par défaut */\r\n    SEARCH_PARAM: 'q',\r\n    \r\n    /** Clé de label par défaut */\r\n    LABEL_KEY: 'label',\r\n    \r\n    /** Hauteur d'un item dans la liste (pour virtual scrolling) */\r\n    ITEM_HEIGHT: 40,\r\n    \r\n    /** Nombre d'items visibles dans la dropdown */\r\n    VISIBLE_ITEMS: 10,\r\n  } as const;\r\n  \r\n  /**\r\n   * Classes CSS utilisées dans le composant\r\n   * @public\r\n   */\r\n  export const CSS_CLASSES = {\r\n    // Container\r\n    CONTAINER: 'comboselect-container',\r\n    \r\n    // Control\r\n    CONTROL: 'comboselect-control',\r\n    CONTROL_OPEN: 'comboselect-control--open',\r\n    CONTROL_DISABLED: 'comboselect-control--disabled',\r\n    CONTROL_LOADING: 'comboselect-control--loading',\r\n    \r\n    // Input\r\n    INPUT: 'comboselect-input',\r\n    INPUT_WRAPPER: 'comboselect-input-wrapper',\r\n    \r\n    // Dropdown\r\n    DROPDOWN: 'comboselect-dropdown',\r\n    DROPDOWN_OPEN: 'comboselect-dropdown--open',\r\n    \r\n    // Suggestions\r\n    SUGGESTIONS: 'comboselect-suggestions',\r\n    SUGGESTION_ITEM: 'comboselect-suggestion',\r\n    SUGGESTION_ACTIVE: 'comboselect-suggestion--active',\r\n    SUGGESTION_DISABLED: 'comboselect-suggestion--disabled',\r\n    \r\n    // Tags\r\n    TAGS_CONTAINER: 'comboselect-tags',\r\n    TAG: 'comboselect-tag',\r\n    TAG_LABEL: 'comboselect-tag-label',\r\n    TAG_REMOVE: 'comboselect-tag-remove',\r\n    TAG_COUNTER: 'comboselect-tag-counter',\r\n    \r\n    // States\r\n    LOADING: 'comboselect-loading',\r\n    LOADING_SPINNER: 'comboselect-loading-spinner',\r\n    NO_RESULTS: 'comboselect-no-results',\r\n    ERROR: 'comboselect-error',\r\n    \r\n    // Utilities\r\n    DISABLED: 'disabled',\r\n    OPEN: 'open',\r\n    HIDDEN: 'hidden',\r\n  } as const;\r\n  \r\n  /**\r\n   * Événements du composant\r\n   * @public\r\n   */\r\n  export const EVENTS = {\r\n    SELECT: 'select',\r\n    REMOVE: 'remove',\r\n    CHANGE: 'change',\r\n    OPEN: 'open',\r\n    CLOSE: 'close',\r\n    SEARCH: 'search',\r\n    ERROR: 'error',\r\n    LOAD: 'load',\r\n    CREATE: 'create',\r\n    NAVIGATE: 'navigate',\r\n    DISABLED: 'disabled',\r\n    ENABLED: 'enabled',\r\n  } as const;\r\n  \r\n  /**\r\n   * Touches du clavier\r\n   * @public\r\n   */\r\n  export const KEYBOARD_KEYS = {\r\n    ARROW_UP: 'ArrowUp',\r\n    ARROW_DOWN: 'ArrowDown',\r\n    ENTER: 'Enter',\r\n    ESCAPE: 'Escape',\r\n    BACKSPACE: 'Backspace',\r\n    TAB: 'Tab',\r\n    DELETE: 'Delete',\r\n  } as const;\r\n  \r\n  /**\r\n   * Attributs ARIA\r\n   * @public\r\n   */\r\n  export const ARIA_ATTRIBUTES = {\r\n    ROLE_COMBOBOX: 'combobox',\r\n    ROLE_LISTBOX: 'listbox',\r\n    ROLE_OPTION: 'option',\r\n    AUTOCOMPLETE: 'list',\r\n    EXPANDED: 'aria-expanded',\r\n    HASPOPUP: 'aria-haspopup',\r\n    ACTIVEDESCENDANT: 'aria-activedescendant',\r\n    SELECTED: 'aria-selected',\r\n    DISABLED: 'aria-disabled',\r\n    LABEL: 'aria-label',\r\n    LABELLEDBY: 'aria-labelledby',\r\n  } as const;\r\n  \r\n  /**\r\n   * Messages d'erreur\r\n   * @public\r\n   */\r\n  export const ERROR_MESSAGES = {\r\n    INVALID_SELECTOR: 'Invalid selector: element not found',\r\n    NOT_INPUT_ELEMENT: 'Element must be an input element',\r\n    MAX_ITEMS_INVALID: 'maxItems must be greater than 0',\r\n    MIN_CHARS_INVALID: 'minChars cannot be negative',\r\n    DEBOUNCE_INVALID: 'debounceDelay cannot be negative',\r\n    INCREMENT_SIZE_INVALID: 'incrementValueSize must be greater than 0',\r\n    NO_DATA_SOURCE: 'Neither autocompleteUrl nor dataSource provided',\r\n    FETCH_ERROR: 'Error fetching data',\r\n    PARSE_ERROR: 'Error parsing response',\r\n  } as const;\r\n  \r\n  /**\r\n   * Headers HTTP par défaut\r\n   * @public\r\n   */\r\n  export const DEFAULT_HTTP_HEADERS = {\r\n    'Content-Type': 'application/json',\r\n    'Accept': 'application/json',\r\n  } as const;\r\n  \r\n  /**\r\n   * Regex patterns\r\n   * @internal\r\n   */\r\n  export const PATTERNS = {\r\n    /** Pattern pour nettoyer le HTML */\r\n    HTML_TAGS: /<[^>]*>/g,\r\n    \r\n    /** Pattern pour les espaces multiples */\r\n    MULTIPLE_SPACES: /\\s+/g,\r\n    \r\n    /** Pattern pour valider une URL */\r\n    URL: /^https?:\\/\\/.+/i,\r\n  } as const;\r\n  \r\n  /**\r\n   * Timeouts et délais\r\n   * @public\r\n   */\r\n  export const TIMEOUTS = {\r\n    /** Délai avant fermeture automatique du dropdown (ms) */\r\n    AUTO_CLOSE: 5000,\r\n    \r\n    /** Délai d'animation CSS (ms) */\r\n    ANIMATION: 200,\r\n    \r\n    /** Délai avant retry en cas d'erreur (ms) */\r\n    RETRY_DELAY: 1000,\r\n    \r\n    /** Timeout pour les requêtes HTTP (ms) */\r\n    HTTP_TIMEOUT: 10000,\r\n  } as const;\r\n  \r\n  /**\r\n   * Limites du composant\r\n   * @public\r\n   */\r\n  export const LIMITS = {\r\n    /** Nombre maximum d'items dans la dropdown */\r\n    MAX_SUGGESTIONS: 100,\r\n    \r\n    /** Longueur maximale du label d'un tag */\r\n    MAX_TAG_LABEL_LENGTH: 50,\r\n    \r\n    /** Nombre maximum d'items sélectionnables par défaut */\r\n    DEFAULT_MAX_ITEMS: 999,\r\n    \r\n    /** Taille maximale du cache (nombre d'entrées) */\r\n    MAX_CACHE_SIZE: 50,\r\n  } as const;\r\n  \r\n  /**\r\n   * Type helper pour extraire les valeurs des constantes\r\n   */\r\n  export type ValueOf<T> = T[keyof T];\r\n  \r\n  /**\r\n   * Type pour les classes CSS\r\n   */\r\n  export type CSSClass = ValueOf<typeof CSS_CLASSES>;\r\n  \r\n  /**\r\n   * Type pour les événements\r\n   */\r\n  export type EventType = ValueOf<typeof EVENTS>;\r\n  \r\n  /**\r\n   * Type pour les touches du clavier\r\n   */\r\n  export type KeyboardKey = ValueOf<typeof KEYBOARD_KEYS>;","/**\r\n * Service de gestion des données\r\n * Gère le chargement et la transformation des données depuis différentes sources\r\n */\r\n\r\nimport type { ComboSelectConfig } from '../types';\r\nimport { DEFAULTS, DEFAULT_HTTP_HEADERS, ERROR_MESSAGES, TIMEOUTS } from '../core/constants';\r\n\r\n/**\r\n * Service pour gérer les sources de données\r\n * @public\r\n */\r\nexport class DataService<T = any> {\r\n  private config: ComboSelectConfig<T>;\r\n  private cache: Map<string, T[]> = new Map();\r\n  private abortController: AbortController | null = null;\r\n\r\n  constructor(config: ComboSelectConfig<T>) {\r\n    this.config = config;\r\n  }\r\n\r\n  /**\r\n   * Charger les données selon la configuration\r\n   * @param query - Requête de recherche (pour API)\r\n   * @returns Promesse avec les données\r\n   */\r\n  async loadData(query?: string): Promise<T[]> {\r\n    // Source locale\r\n    if (this.config.dataSource) {\r\n      return this.loadLocalData();\r\n    }\r\n\r\n    // Source API\r\n    if (this.config.autocompleteUrl) {\r\n      return this.loadRemoteData(query || '');\r\n    }\r\n\r\n    throw new Error(ERROR_MESSAGES.NO_DATA_SOURCE);\r\n  }\r\n\r\n  /**\r\n   * Charger les données locales\r\n   * @private\r\n   */\r\n  private async loadLocalData(): Promise<T[]> {\r\n    const { dataSource } = this.config;\r\n\r\n    if (!dataSource) {\r\n      return [];\r\n    }\r\n\r\n    // Si c'est une fonction\r\n    if (typeof dataSource === 'function') {\r\n      const result = dataSource();\r\n      // Si la fonction retourne une promesse\r\n      if (result instanceof Promise) {\r\n        return await result;\r\n      }\r\n      return result;\r\n    }\r\n\r\n    // Si c'est un tableau\r\n    return dataSource;\r\n  }\r\n\r\n  /**\r\n   * Charger les données depuis une API\r\n   * @param query - Requête de recherche\r\n   * @private\r\n   */\r\n  private async loadRemoteData(query: string): Promise<T[]> {\r\n    const { autocompleteUrl, searchParam, httpMethod, httpHeaders } = this.config;\r\n\r\n    if (!autocompleteUrl) {\r\n      throw new Error(ERROR_MESSAGES.NO_DATA_SOURCE);\r\n    }\r\n\r\n    // Vérifier le cache\r\n    const cacheKey = `${autocompleteUrl}:${query}`;\r\n    if (this.cache.has(cacheKey)) {\r\n      return this.cache.get(cacheKey)!;\r\n    }\r\n\r\n    // Annuler la requête précédente si elle existe\r\n    if (this.abortController) {\r\n      this.abortController.abort();\r\n    }\r\n\r\n    this.abortController = new AbortController();\r\n\r\n    try {\r\n      let url = autocompleteUrl;\r\n      let fetchOptions: RequestInit = {\r\n        signal: this.abortController.signal,\r\n        headers: {\r\n          ...DEFAULT_HTTP_HEADERS,\r\n          ...httpHeaders,\r\n        },\r\n      };\r\n\r\n      const method = httpMethod || DEFAULTS.HTTP_METHOD;\r\n      const param = searchParam || DEFAULTS.SEARCH_PARAM;\r\n\r\n      if (method === 'GET') {\r\n        // Ajouter le paramètre de recherche à l'URL\r\n        const separator = url.includes('?') ? '&' : '?';\r\n        url = `${url}${separator}${param}=${encodeURIComponent(query)}`;\r\n        fetchOptions.method = 'GET';\r\n      } else {\r\n        // POST - Envoyer dans le body\r\n        fetchOptions.method = 'POST';\r\n        fetchOptions.body = JSON.stringify({ [param]: query });\r\n      }\r\n\r\n      // Timeout\r\n      const timeoutId = setTimeout(() => {\r\n        this.abortController?.abort();\r\n      }, TIMEOUTS.HTTP_TIMEOUT);\r\n\r\n      const response = await fetch(url, fetchOptions);\r\n      clearTimeout(timeoutId);\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`${ERROR_MESSAGES.FETCH_ERROR}: ${response.status} ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      const results = this.extractResults(data);\r\n\r\n      // Mettre en cache\r\n      this.cache.set(cacheKey, results);\r\n\r\n      return results;\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        if (error.name === 'AbortError') {\r\n          // Requête annulée, ne pas logger\r\n          return [];\r\n        }\r\n        throw new Error(`${ERROR_MESSAGES.FETCH_ERROR}: ${error.message}`);\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extraire les résultats de la réponse API\r\n   * @param data - Données brutes de l'API\r\n   * @private\r\n   */\r\n  private extractResults(data: any): T[] {\r\n    const { resultsKey, transformResponse } = this.config;\r\n\r\n    // Si une fonction de transformation est fournie\r\n    if (transformResponse) {\r\n      try {\r\n        return transformResponse(data);\r\n      } catch (error) {\r\n        throw new Error(ERROR_MESSAGES.PARSE_ERROR);\r\n      }\r\n    }\r\n\r\n    // Si une clé de résultats est spécifiée\r\n    if (resultsKey) {\r\n      try {\r\n        // Support pour les clés imbriquées: \"data.items\" ou [\"data\", \"items\"]\r\n        const keys = Array.isArray(resultsKey) ? resultsKey : resultsKey.split('.');\r\n        let result = data;\r\n\r\n        for (const key of keys) {\r\n          if (result && typeof result === 'object' && key in result) {\r\n            result = result[key];\r\n          } else {\r\n            throw new Error(`Key \"${key}\" not found in response`);\r\n          }\r\n        }\r\n\r\n        if (Array.isArray(result)) {\r\n          return result as T[];\r\n        }\r\n\r\n        throw new Error('Results is not an array');\r\n      } catch (error) {\r\n        console.error('Error extracting results:', error);\r\n        throw new Error(ERROR_MESSAGES.PARSE_ERROR);\r\n      }\r\n    }\r\n\r\n    // Par défaut, retourner les données si c'est un tableau\r\n    if (Array.isArray(data)) {\r\n      return data as T[];\r\n    }\r\n\r\n    throw new Error(ERROR_MESSAGES.PARSE_ERROR);\r\n  }\r\n\r\n  /**\r\n   * Filtrer les données localement\r\n   * @param data - Données à filtrer\r\n   * @param query - Requête de recherche\r\n   * @returns Données filtrées\r\n   */\r\n  filterData(data: T[], query: string): T[] {\r\n    if (!query || query.trim() === '') {\r\n      return data;\r\n    }\r\n\r\n    const searchTerm = query.toLowerCase().trim();\r\n    const { labelSuggestion } = this.config;\r\n    const labelKey = (labelSuggestion as string) || DEFAULTS.LABEL_KEY;\r\n\r\n    return data.filter((item) => {\r\n      // Récupérer le label de l'item\r\n      const label = this.getItemLabel(item, labelKey);\r\n      return label.toLowerCase().includes(searchTerm);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Obtenir le label d'un item\r\n   * @param item - Item\r\n   * @param labelKey - Clé du label\r\n   * @private\r\n   */\r\n  private getItemLabel(item: T, labelKey: string): string {\r\n    if (typeof item === 'string') {\r\n      return item;\r\n    }\r\n\r\n    if (typeof item === 'object' && item !== null) {\r\n      const value = (item as any)[labelKey];\r\n      return value !== undefined && value !== null ? String(value) : '';\r\n    }\r\n\r\n    return String(item);\r\n  }\r\n\r\n  /**\r\n   * Vider le cache\r\n   */\r\n  clearCache(): void {\r\n    this.cache.clear();\r\n  }\r\n\r\n  /**\r\n   * Annuler les requêtes en cours\r\n   */\r\n  abort(): void {\r\n    if (this.abortController) {\r\n      this.abortController.abort();\r\n      this.abortController = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Obtenir la taille du cache\r\n   */\r\n  getCacheSize(): number {\r\n    return this.cache.size;\r\n  }\r\n\r\n  /**\r\n   * Supprimer une entrée du cache\r\n   * @param query - Requête à supprimer du cache\r\n   */\r\n  removeCacheEntry(query: string): void {\r\n    const { autocompleteUrl } = this.config;\r\n    if (autocompleteUrl) {\r\n      const cacheKey = `${autocompleteUrl}:${query}`;\r\n      this.cache.delete(cacheKey);\r\n    }\r\n  }\r\n}","/**\r\n * Service de recherche\r\n * Gère la recherche, le debounce et les événements associés\r\n */\r\n\r\nimport type { ComboSelectConfig, SuggestionItem } from '../types';\r\nimport { DataService } from './DataService';\r\nimport { DEFAULTS } from '../core/constants';\r\n\r\n/**\r\n * Type pour le callback de résultats\r\n */\r\ntype SearchResultCallback<T> = (results: SuggestionItem<T>[]) => void;\r\n\r\n/**\r\n * Type pour le callback d'erreur\r\n */\r\ntype SearchErrorCallback = (error: Error) => void;\r\n\r\n/**\r\n * Service pour gérer la recherche\r\n * @public\r\n */\r\nexport class SearchService<T = any> {\r\n  private config: ComboSelectConfig<T>;\r\n  private dataService: DataService<T>;\r\n  private debounceTimer: number | null = null;\r\n  private lastQuery: string = '';\r\n  private isSearching: boolean = false;\r\n\r\n  // Callbacks\r\n  private onResults: SearchResultCallback<T> | null = null;\r\n  private onError: SearchErrorCallback | null = null;\r\n  private onSearchStart: (() => void) | null = null;\r\n  private onSearchEnd: (() => void) | null = null;\r\n\r\n  constructor(config: ComboSelectConfig<T>, dataService: DataService<T>) {\r\n    this.config = config;\r\n    this.dataService = dataService;\r\n  }\r\n\r\n  /**\r\n   * Effectuer une recherche\r\n   * @param query - Requête de recherche\r\n   */\r\n  search(query: string): void {\r\n    // Vérifier le nombre minimum de caractères\r\n    const minChars = this.config.minChars ?? DEFAULTS.MIN_CHARS;\r\n    \r\n    if (query.length < minChars) {\r\n      this.clearResults();\r\n      return;\r\n    }\r\n\r\n    // Si la requête n'a pas changé, ne rien faire\r\n    if (query === this.lastQuery) {\r\n      return;\r\n    }\r\n\r\n    this.lastQuery = query;\r\n\r\n    // Annuler le timer précédent\r\n    this.cancelDebounce();\r\n\r\n    // Appliquer le debounce\r\n    const debounceDelay = this.config.debounceDelay ?? DEFAULTS.DEBOUNCE_DELAY;\r\n    \r\n    this.debounceTimer = window.setTimeout(() => {\r\n      this.performSearch(query);\r\n    }, debounceDelay);\r\n  }\r\n\r\n  /**\r\n   * Effectuer la recherche immédiatement (sans debounce)\r\n   * @param query - Requête de recherche\r\n   */\r\n  searchImmediate(query: string): void {\r\n    this.cancelDebounce();\r\n    this.lastQuery = query;\r\n    this.performSearch(query);\r\n  }\r\n\r\n  /**\r\n   * Effectuer la recherche réelle\r\n   * @param query - Requête de recherche\r\n   * @private\r\n   */\r\n  private async performSearch(query: string): Promise<void> {\r\n    if (this.isSearching) {\r\n      return;\r\n    }\r\n\r\n    this.isSearching = true;\r\n    this.onSearchStart?.();\r\n\r\n    // Callback onSearch si défini\r\n    if (this.config.onSearch) {\r\n      try {\r\n        await this.config.onSearch(query);\r\n      } catch (error) {\r\n        console.error('Error in onSearch callback:', error);\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Charger les données\r\n      const data = await this.dataService.loadData(query);\r\n\r\n      // Filtrer si source locale\r\n      let filteredData = data;\r\n      if (this.config.dataSource) {\r\n        filteredData = this.dataService.filterData(data, query);\r\n      }\r\n\r\n      // Transformer en SuggestionItems\r\n      const suggestions = this.transformToSuggestions(filteredData);\r\n\r\n      // Envoyer les résultats\r\n      this.onResults?.(suggestions);\r\n\r\n      // Callback onLoad si défini\r\n      if (this.config.onLoad) {\r\n        try {\r\n          await this.config.onLoad(filteredData);\r\n        } catch (error) {\r\n          console.error('Error in onLoad callback:', error);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      const errorObj = error instanceof Error ? error : new Error('Search failed');\r\n      this.onError?.(errorObj);\r\n\r\n      // Callback onError si défini\r\n      if (this.config.onError) {\r\n        try {\r\n          await this.config.onError(errorObj);\r\n        } catch (callbackError) {\r\n          console.error('Error in onError callback:', callbackError);\r\n        }\r\n      }\r\n    } finally {\r\n      this.isSearching = false;\r\n      this.onSearchEnd?.();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transformer les données en SuggestionItems\r\n   * @param data - Données brutes\r\n   * @private\r\n   */\r\n  private transformToSuggestions(data: T[]): SuggestionItem<T>[] {\r\n    const { labelSuggestion, valueSuggestion } = this.config;\r\n    const labelKey = (labelSuggestion as string) || DEFAULTS.LABEL_KEY;\r\n    const valueKey = valueSuggestion as string | null;\r\n\r\n    return data.map((item) => {\r\n      let label: string;\r\n      let value: any;\r\n\r\n      // Extraire le label\r\n      if (typeof item === 'string') {\r\n        label = item;\r\n        value = item;\r\n      } else if (typeof item === 'object' && item !== null) {\r\n        label = String((item as any)[labelKey] ?? '');\r\n        value = valueKey ? (item as any)[valueKey] : (item as any)[labelKey];\r\n      } else {\r\n        label = String(item);\r\n        value = item;\r\n      }\r\n\r\n      return {\r\n        label,\r\n        value,\r\n        original: item,\r\n        disabled: false,\r\n        highlighted: false,\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Vider les résultats\r\n   */\r\n  clearResults(): void {\r\n    this.lastQuery = '';\r\n    this.onResults?.([]);\r\n  }\r\n\r\n  /**\r\n   * Annuler le debounce en cours\r\n   */\r\n  cancelDebounce(): void {\r\n    if (this.debounceTimer !== null) {\r\n      clearTimeout(this.debounceTimer);\r\n      this.debounceTimer = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Annuler toutes les requêtes en cours\r\n   */\r\n  abort(): void {\r\n    this.cancelDebounce();\r\n    this.dataService.abort();\r\n    this.isSearching = false;\r\n  }\r\n\r\n  /**\r\n   * Définir le callback pour les résultats\r\n   * @param callback - Fonction appelée avec les résultats\r\n   */\r\n  setOnResults(callback: SearchResultCallback<T>): void {\r\n    this.onResults = callback;\r\n  }\r\n\r\n  /**\r\n   * Définir le callback pour les erreurs\r\n   * @param callback - Fonction appelée en cas d'erreur\r\n   */\r\n  setOnError(callback: SearchErrorCallback): void {\r\n    this.onError = callback;\r\n  }\r\n\r\n  /**\r\n   * Définir le callback pour le début de recherche\r\n   * @param callback - Fonction appelée au début de la recherche\r\n   */\r\n  setOnSearchStart(callback: () => void): void {\r\n    this.onSearchStart = callback;\r\n  }\r\n\r\n  /**\r\n   * Définir le callback pour la fin de recherche\r\n   * @param callback - Fonction appelée à la fin de la recherche\r\n   */\r\n  setOnSearchEnd(callback: () => void): void {\r\n    this.onSearchEnd = callback;\r\n  }\r\n\r\n  /**\r\n   * Vérifier si une recherche est en cours\r\n   */\r\n  get searching(): boolean {\r\n    return this.isSearching;\r\n  }\r\n\r\n  /**\r\n   * Obtenir la dernière requête\r\n   */\r\n  getLastQuery(): string {\r\n    return this.lastQuery;\r\n  }\r\n\r\n  /**\r\n   * Réinitialiser le service\r\n   */\r\n  reset(): void {\r\n    this.abort();\r\n    this.clearResults();\r\n    this.lastQuery = '';\r\n  }\r\n}","export class DOMHelpers {\r\n    static createElement<K extends keyof HTMLElementTagNameMap>(\r\n      tag: K,\r\n      className?: string,\r\n      attributes?: Record<string, string>\r\n    ): HTMLElementTagNameMap[K] {\r\n      const element = document.createElement(tag);\r\n      \r\n      if (className) {\r\n        element.className = className;\r\n      }\r\n      \r\n      if (attributes) {\r\n        Object.entries(attributes).forEach(([key, value]) => {\r\n          element.setAttribute(key, value);\r\n        });\r\n      }\r\n      \r\n      return element;\r\n    }\r\n  \r\n    static removeAllChildren(element: HTMLElement): void {\r\n      while (element.firstChild) {\r\n        element.removeChild(element.firstChild);\r\n      }\r\n    }\r\n  \r\n    static escapeHtml(text: string): string {\r\n      const div = document.createElement('div');\r\n      div.textContent = text;\r\n      return div.innerHTML;\r\n    }\r\n  \r\n    static getOffset(element: HTMLElement): { top: number; left: number } {\r\n      const rect = element.getBoundingClientRect();\r\n      return {\r\n        top: rect.top + window.scrollY,\r\n        left: rect.left + window.scrollX,\r\n      };\r\n    }\r\n  \r\n    static isDescendant(parent: HTMLElement, child: HTMLElement): boolean {\r\n      let node: HTMLElement | null = child;\r\n      while (node) {\r\n        if (node === parent) {\r\n          return true;\r\n        }\r\n        node = node.parentElement;\r\n      }\r\n      return false;\r\n    }\r\n  }","import type { SuggestionItem, SelectedItem } from '../types/index';\r\nimport { Config } from '@core/Config';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class RenderService {\r\n  private config: Config;\r\n\r\n  constructor(config: Config) {\r\n    this.config = config;\r\n  }\r\n\r\n  renderSuggestion(item: SuggestionItem): string {\r\n    const customRender = this.config.get('renderSuggestion');\r\n    \r\n    if (customRender) {\r\n      return customRender(item.original);\r\n    }\r\n\r\n    return DOMHelpers.escapeHtml(item.label);\r\n  }\r\n\r\n  renderTag(item: SelectedItem): string {\r\n    const customRender = this.config.get('renderTag');\r\n    \r\n    if (customRender) {\r\n      return customRender(item);\r\n    }\r\n\r\n    return DOMHelpers.escapeHtml(item.label);\r\n  }\r\n\r\n  renderNoResults(): string {\r\n    return '<div class=\"comboselect-no-results\">Aucun résultat trouvé</div>';\r\n  }\r\n\r\n  renderLoading(): string {\r\n    return `\r\n      <div class=\"comboselect-loading\">\r\n        <span class=\"comboselect-loading-spinner\"></span>\r\n        <span>Chargement...</span>\r\n      </div>\r\n    `;\r\n  }\r\n}","export function debounce<T extends (...args: any[]) => any>(\r\n    func: T,\r\n    wait: number\r\n  ): (...args: Parameters<T>) => void {\r\n    let timeout: ReturnType<typeof setTimeout> | null = null;\r\n  \r\n    return function executedFunction(...args: Parameters<T>) {\r\n      const later = () => {\r\n        timeout = null;\r\n        func(...args);\r\n      };\r\n  \r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n      }\r\n      timeout = setTimeout(later, wait);\r\n    };\r\n  }","import { Config } from '@core/Config';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\nimport { debounce } from '@utils/Debounce';\r\n\r\nexport class Input {\r\n  private element: HTMLInputElement;\r\n  private config: Config;\r\n  private events: EventEmitter;\r\n  private debouncedSearch: (query: string) => void;\r\n\r\n  constructor(config: Config, events: EventEmitter) {\r\n    this.config = config;\r\n    this.events = events;\r\n    this.element = this.create();\r\n    this.debouncedSearch = debounce(\r\n      (query: string) => this.handleSearch(query),\r\n      config.get('debounceDelay') || 300\r\n    );\r\n    this.attachEvents();\r\n  }\r\n\r\n  private create(): HTMLInputElement {\r\n    const input = DOMHelpers.createElement('input', 'comboselect-input', {\r\n      type: 'text',\r\n      placeholder: this.config.get('placeholder') || '',\r\n      autocomplete: 'off',\r\n      role: 'combobox',\r\n      'aria-autocomplete': 'list',\r\n      'aria-expanded': 'false',\r\n      'aria-haspopup': 'listbox',\r\n    });\r\n\r\n    return input;\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    this.element.addEventListener('input', (e) => {\r\n      const target = e.target as HTMLInputElement;\r\n      const query = target.value.trim();\r\n      const minChars = this.config.get('minChars') || 1;\r\n\r\n      if (query.length >= minChars) {\r\n        this.debouncedSearch(query);\r\n      } else if (query.length === 0) {\r\n        this.events.emit('close');\r\n      }\r\n    });\r\n\r\n    this.element.addEventListener('focus', () => {\r\n      const query = this.element.value.trim();\r\n      const minChars = this.config.get('minChars') || 1;\r\n      \r\n      if (query.length >= minChars) {\r\n        this.handleSearch(query);\r\n      }\r\n    });\r\n\r\n    this.element.addEventListener('keydown', (e) => {\r\n      this.handleKeydown(e);\r\n    });\r\n  }\r\n\r\n  private handleSearch(query: string): void {\r\n    this.events.emit('search', query);\r\n  }\r\n\r\n  private handleKeydown(e: KeyboardEvent): void {\r\n    switch (e.key) {\r\n      case 'ArrowDown':\r\n        e.preventDefault();\r\n        this.events.emit('navigate', 'down');\r\n        break;\r\n      case 'ArrowUp':\r\n        e.preventDefault();\r\n        this.events.emit('navigate', 'up');\r\n        break;\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        this.events.emit('navigate', 'select');\r\n        break;\r\n      case 'Escape':\r\n        e.preventDefault();\r\n        this.events.emit('close');\r\n        break;\r\n    }\r\n  }\r\n\r\n  getElement(): HTMLInputElement {\r\n    return this.element;\r\n  }\r\n\r\n  getValue(): string {\r\n    return this.element.value;\r\n  }\r\n\r\n  setValue(value: string): void {\r\n    this.element.value = value;\r\n  }\r\n\r\n  clear(): void {\r\n    this.element.value = '';\r\n  }\r\n\r\n  focus(): void {\r\n    this.element.focus();\r\n  }\r\n\r\n  disable(): void {\r\n    this.element.disabled = true;\r\n  }\r\n\r\n  enable(): void {\r\n    this.element.disabled = false;\r\n  }\r\n\r\n  setAriaExpanded(expanded: boolean): void {\r\n    this.element.setAttribute('aria-expanded', String(expanded));\r\n  }\r\n\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}","import type { SuggestionItem } from '../types/index';\r\n\r\nimport { EventEmitter } from '@core/EventEmitter';\r\nimport { RenderService } from '@services/RenderService';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class Dropdown {\r\n  private element: HTMLElement;\r\n  private events: EventEmitter;\r\n  private renderService: RenderService;\r\n  private suggestions: SuggestionItem[];\r\n  private focusedIndex: number;\r\n  private isOpen: boolean;\r\n\r\n  constructor(\r\n    events: EventEmitter, \r\n    renderService: RenderService\r\n  ) {\r\n    this.events = events;\r\n    this.renderService = renderService;\r\n    this.suggestions = [];\r\n    this.focusedIndex = -1;\r\n    this.isOpen = false;\r\n    this.element = this.create();\r\n    this.attachEvents();\r\n  }\r\n\r\n  private create(): HTMLElement {\r\n    const dropdown = DOMHelpers.createElement('div', 'comboselect-dropdown hidden', {\r\n      role: 'listbox',\r\n    });\r\n\r\n    return dropdown;\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    this.events.on('navigate', (direction: 'up' | 'down' | 'select') => {\r\n      this.handleNavigation(direction);\r\n    });\r\n  }\r\n\r\n  open(): void {\r\n    if (!this.isOpen) {\r\n      this.element.classList.remove('hidden');\r\n      this.isOpen = true;\r\n      this.events.emit('open');\r\n    }\r\n  }\r\n\r\n  close(): void {\r\n    if (this.isOpen) {\r\n      this.element.classList.add('hidden');\r\n      this.isOpen = false;\r\n      this.focusedIndex = -1;\r\n      this.events.emit('close');\r\n    }\r\n  }\r\n\r\n  render(suggestions: SuggestionItem[]): void {\r\n    this.suggestions = suggestions;\r\n    this.focusedIndex = -1;\r\n    DOMHelpers.removeAllChildren(this.element);\r\n\r\n    if (suggestions.length === 0) {\r\n      this.element.innerHTML = this.renderService.renderNoResults();\r\n      this.open();\r\n      return;\r\n    }\r\n\r\n    suggestions.forEach((suggestion, index) => {\r\n      const option = this.createOption(suggestion, index);\r\n      this.element.appendChild(option);\r\n    });\r\n\r\n    this.open();\r\n  }\r\n\r\n  renderLoading(): void {\r\n    DOMHelpers.removeAllChildren(this.element);\r\n    this.element.innerHTML = this.renderService.renderLoading();\r\n    this.open();\r\n  }\r\n\r\n  private createOption(suggestion: SuggestionItem, index: number): HTMLElement {\r\n    const option = DOMHelpers.createElement('div', 'comboselect-option', {\r\n      role: 'option',\r\n      'data-index': String(index),\r\n    });\r\n\r\n    option.innerHTML = this.renderService.renderSuggestion(suggestion);\r\n\r\n    if (suggestion.disabled) {\r\n      option.classList.add('disabled');\r\n      option.setAttribute('aria-disabled', 'true');\r\n    }\r\n\r\n    option.addEventListener('mousedown', (e) => {\r\n      e.preventDefault();\r\n      if (!suggestion.disabled) {\r\n        this.selectOption(index);\r\n      }\r\n    });\r\n\r\n    option.addEventListener('mouseenter', () => {\r\n      if (!suggestion.disabled) {\r\n        this.focusOption(index);\r\n      }\r\n    });\r\n\r\n    return option;\r\n  }\r\n\r\n  private handleNavigation(direction: 'up' | 'down' | 'select'): void {\r\n    if (!this.isOpen || this.suggestions.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (direction === 'select') {\r\n      if (this.focusedIndex >= 0) {\r\n        this.selectOption(this.focusedIndex);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const maxIndex = this.suggestions.length - 1;\r\n    let newIndex = this.focusedIndex;\r\n\r\n    if (direction === 'down') {\r\n      newIndex = this.focusedIndex < maxIndex ? this.focusedIndex + 1 : 0;\r\n    } else if (direction === 'up') {\r\n      newIndex = this.focusedIndex > 0 ? this.focusedIndex - 1 : maxIndex;\r\n    }\r\n\r\n    while (this.suggestions[newIndex]?.disabled) {\r\n      if (direction === 'down') {\r\n        newIndex = newIndex < maxIndex ? newIndex + 1 : 0;\r\n      } else {\r\n        newIndex = newIndex > 0 ? newIndex - 1 : maxIndex;\r\n      }\r\n\r\n      if (newIndex === this.focusedIndex) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.focusOption(newIndex);\r\n  }\r\n\r\n  private focusOption(index: number): void {\r\n    if (this.focusedIndex >= 0) {\r\n      const prevOption = this.element.querySelector(`[data-index=\"${this.focusedIndex}\"]`);\r\n      prevOption?.classList.remove('focused');\r\n    }\r\n\r\n    this.focusedIndex = index;\r\n\r\n    const option = this.element.querySelector(`[data-index=\"${index}\"]`);\r\n    if (option) {\r\n      option.classList.add('focused');\r\n      option.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }\r\n\r\n  private selectOption(index: number): void {\r\n    const suggestion = this.suggestions[index];\r\n    if (suggestion && !suggestion.disabled) {\r\n      this.events.emit('select', {\r\n        label: suggestion.label,\r\n        value: suggestion.value,\r\n        original: suggestion.original,\r\n      });\r\n    }\r\n  }\r\n\r\n  getElement(): HTMLElement {\r\n    return this.element;\r\n  }\r\n\r\n  isDropdownOpen(): boolean {\r\n    return this.isOpen;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.close();\r\n    this.element.remove();\r\n  }\r\n}","import type { SelectedItem } from '../types/index';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\n\r\nexport class Tag {\r\n  private element: HTMLElement;\r\n  private item: SelectedItem;\r\n  private events: EventEmitter;\r\n\r\n  constructor(item: SelectedItem, renderContent: string, events: EventEmitter) {\r\n    this.item = item;\r\n    this.events = events;\r\n    this.element = this.create(renderContent);\r\n  }\r\n\r\n  private create(renderContent: string): HTMLElement {\r\n    const tag = DOMHelpers.createElement('span', 'comboselect-tag');\r\n    tag.setAttribute('data-value', JSON.stringify(this.item.value));\r\n    \r\n    const content = DOMHelpers.createElement('span');\r\n    content.innerHTML = renderContent;\r\n    tag.appendChild(content);\r\n\r\n    const removeBtn = DOMHelpers.createElement('button', 'comboselect-tag-remove', {\r\n      type: 'button',\r\n      'aria-label': `Retirer ${this.item.label}`,\r\n    });\r\n    removeBtn.innerHTML = '&times;';\r\n    removeBtn.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      this.remove();\r\n    });\r\n\r\n    tag.appendChild(removeBtn);\r\n\r\n    return tag;\r\n  }\r\n\r\n  private remove(): void {\r\n    this.events.emit('remove', this.item);\r\n    this.element.remove();\r\n  }\r\n\r\n  getElement(): HTMLElement {\r\n    return this.element;\r\n  }\r\n\r\n  getItem(): SelectedItem {\r\n    return this.item;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}","import type { SelectedItem } from '../types/index';\r\nimport { Config } from '@core/Config';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\nimport { RenderService } from '@services/RenderService';\r\nimport { Tag } from './Tag';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class TagList {\r\n  private container: HTMLElement;\r\n  private config: Config;\r\n  private events: EventEmitter;\r\n  private renderService: RenderService;\r\n  private tags: Tag[];\r\n  private counterElement?: HTMLElement;\r\n\r\n  constructor(\r\n    container: HTMLElement,\r\n    config: Config,\r\n    events: EventEmitter,\r\n    renderService: RenderService\r\n  ) {\r\n    this.container = container;\r\n    this.config = config;\r\n    this.events = events;\r\n    this.renderService = renderService;\r\n    this.tags = [];\r\n  }\r\n\r\n  add(item: SelectedItem): boolean {\r\n    const existingTagIndex = this.tags.findIndex((tag) => {\r\n      const existingValue = JSON.stringify(tag.getItem().value);\r\n      const newValue = JSON.stringify(item.value);\r\n      return existingValue === newValue;\r\n    });\r\n\r\n    if (existingTagIndex !== -1) {\r\n      console.warn('Item already selected:', item);\r\n      this.highlightTag(existingTagIndex);\r\n      return false;\r\n    }\r\n\r\n    const renderContent = this.renderService.renderTag(item);\r\n    const tag = new Tag(item, renderContent, this.events);\r\n    this.tags.push(tag);\r\n    this.render();\r\n    return true;\r\n  }\r\n\r\n  public hasItem(item: SelectedItem): boolean {\r\n    return this.tags.some((tag) => {\r\n      const existingValue = JSON.stringify(tag.getItem().value);\r\n      const newValue = JSON.stringify(item.value);\r\n      return existingValue === newValue;\r\n    });\r\n  }\r\n\r\n  private highlightTag(index: number): void {\r\n    const tag = this.tags[index];\r\n    if (!tag) return;\r\n\r\n    const element = tag.getElement();\r\n    element.classList.add('comboselect-tag-highlight');\r\n    \r\n    setTimeout(() => {\r\n      element.classList.remove('comboselect-tag-highlight');\r\n    }, 600);\r\n  }\r\n\r\n  remove(item: SelectedItem): void {\r\n    const index = this.tags.findIndex(\r\n      (tag) => JSON.stringify(tag.getItem().value) === JSON.stringify(item.value)\r\n    );\r\n\r\n    if (index !== -1) {\r\n      this.tags[index]?.destroy();\r\n      this.tags.splice(index, 1);\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.tags.forEach((tag) => tag.destroy());\r\n    this.tags = [];\r\n    this.render();\r\n  }\r\n\r\n  getItems(): SelectedItem[] {\r\n    return this.tags.map((tag) => tag.getItem());\r\n  }\r\n\r\n  private render(): void {\r\n    DOMHelpers.removeAllChildren(this.container);\r\n\r\n    const incrementSize = this.config.get('incrementValueSize');\r\n\r\n    if (incrementSize && this.tags.length > incrementSize) {\r\n      const visibleTags = this.tags.slice(0, incrementSize);\r\n      visibleTags.forEach((tag) => {\r\n        this.container.appendChild(tag.getElement());\r\n      });\r\n\r\n      const remainingCount = this.tags.length - incrementSize;\r\n      this.renderCounter(remainingCount);\r\n    } else {\r\n      this.tags.forEach((tag) => {\r\n        this.container.appendChild(tag.getElement());\r\n      });\r\n    }\r\n  }\r\n\r\n  private renderCounter(count: number): void {\r\n    if (this.counterElement) {\r\n      this.counterElement.remove();\r\n    }\r\n\r\n    this.counterElement = DOMHelpers.createElement('span', 'comboselect-tag-counter');\r\n    this.counterElement.textContent = `+${count}`;\r\n    this.counterElement.title = `${count} élément(s) supplémentaire(s)`;\r\n    this.container.appendChild(this.counterElement);\r\n  }\r\n\r\n  canAddMore(): boolean {\r\n    const maxItems = this.config.get('maxItems');\r\n    return !maxItems || this.tags.length < maxItems;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.tags.forEach((tag) => tag.destroy());\r\n    this.tags = [];\r\n    DOMHelpers.removeAllChildren(this.container);\r\n  }\r\n}","import type { ComboSelectConfig, SelectedItem, SuggestionItem } from '../types/index';\r\nimport { Config } from './Config';\r\nimport { EventEmitter } from './EventEmitter';\r\nimport { DataService } from '@services/DataService';\r\nimport { SearchService } from '@services/SearchService';\r\nimport { RenderService } from '@services/RenderService';\r\nimport { Input } from '@components/Input';\r\nimport { Dropdown } from '@components/Dropdown';\r\nimport { TagList } from '@components/TagList';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class ComboSelect {\r\n  private originalInput: HTMLInputElement;\r\n  public config: Config;\r\n  private events: EventEmitter;\r\n  private container: HTMLElement;\r\n  private controlElement: HTMLElement;\r\n  private tagsContainer: HTMLElement;\r\n  private hiddenInput: HTMLInputElement;\r\n  private rootElement: Document | ShadowRoot;\r\n  private clickHandler?: (e: Event) => void; // ← AJOUT\r\n  \r\n  // Services\r\n  private dataService: DataService<any>;\r\n  private searchService: SearchService<any>;\r\n  private renderService: RenderService;\r\n  \r\n  // Components\r\n  private input: Input;\r\n  private dropdown: Dropdown;\r\n  public tagList: TagList;\r\n  \r\n  // State\r\n  private isDisabled: boolean;\r\n\r\n  constructor(selector: string | HTMLInputElement, options: Partial<ComboSelectConfig> = {}) {\r\n    let element: HTMLInputElement;\r\n    \r\n    if (typeof selector === 'string') {\r\n      const el = document.querySelector(selector);\r\n      if (!el || !(el instanceof HTMLInputElement)) {\r\n        throw new Error(`Element \"${selector}\" not found or is not an input element`);\r\n      }\r\n      element = el;\r\n    } else if (selector instanceof HTMLInputElement) {\r\n      element = selector;\r\n    } else {\r\n      throw new Error('Selector must be a string or an HTMLInputElement');\r\n    }\r\n\r\n    this.originalInput = element;\r\n    this.rootElement = element.getRootNode() as Document | ShadowRoot;\r\n    \r\n    this.config = new Config(options);\r\n    this.events = new EventEmitter();\r\n    this.isDisabled = false;\r\n\r\n    const fullConfig = this.config.getAll();\r\n    this.dataService = new DataService<any>(fullConfig as any);\r\n    this.searchService = new SearchService<any>(fullConfig as any, this.dataService);\r\n    this.renderService = new RenderService(this.config);\r\n\r\n    this.container = this.createContainer();\r\n    this.controlElement = this.createControl();\r\n    this.tagsContainer = this.createTagsContainer();\r\n    this.hiddenInput = this.createHiddenInput();\r\n\r\n    this.input = new Input(this.config, this.events);\r\n    this.dropdown = new Dropdown(this.events, this.renderService);\r\n    this.tagList = new TagList(this.tagsContainer, this.config, this.events, this.renderService);\r\n\r\n    this.assemble();\r\n    this.attachEvents();\r\n    this.setupSearchCallbacks();\r\n    this.loadCustomCSS();\r\n\r\n    this.originalInput.style.display = 'none';\r\n  }\r\n\r\n  private createContainer(): HTMLElement {\r\n    const container = DOMHelpers.createElement('div', 'comboselect-wrapper');\r\n    return container;\r\n  }\r\n\r\n  private createControl(): HTMLElement {\r\n    const control = DOMHelpers.createElement('div', 'comboselect-control');\r\n    \r\n    control.addEventListener('click', () => {\r\n      if (!this.isDisabled) {\r\n        this.input.focus();\r\n      }\r\n    });\r\n\r\n    return control;\r\n  }\r\n\r\n  private createTagsContainer(): HTMLElement {\r\n    return DOMHelpers.createElement('div', 'comboselect-tags');\r\n  }\r\n\r\n  private createHiddenInput(): HTMLInputElement {\r\n    const input = DOMHelpers.createElement('input', '', {\r\n      type: 'hidden',\r\n      name: this.originalInput.name || '',\r\n    }) as HTMLInputElement;\r\n    return input;\r\n  }\r\n\r\n  private assemble(): void {\r\n    this.originalInput.parentNode?.insertBefore(this.container, this.originalInput.nextSibling);\r\n\r\n    this.controlElement.appendChild(this.tagsContainer);\r\n    this.controlElement.appendChild(this.input.getElement());\r\n    \r\n    this.container.appendChild(this.controlElement);\r\n    this.container.appendChild(this.dropdown.getElement());\r\n    this.container.appendChild(this.hiddenInput);\r\n  }\r\n\r\n  private setupSearchCallbacks(): void {\r\n    this.searchService.setOnResults((suggestions: SuggestionItem<any>[]) => {\r\n      const selected = this.tagList.getItems();\r\n      const selectedValues = new Set(selected.map(item => JSON.stringify(item.value)));\r\n      \r\n      const filteredSuggestions = suggestions.map(suggestion => ({\r\n        ...suggestion,\r\n        disabled: selectedValues.has(JSON.stringify(suggestion.value))\r\n      }));\r\n\r\n      this.dropdown.render(filteredSuggestions);\r\n    });\r\n\r\n    this.searchService.setOnError((error: Error) => {\r\n      console.error('Search error:', error);\r\n      this.dropdown.render([]);\r\n    });\r\n\r\n    this.searchService.setOnSearchStart(() => {\r\n    \r\n      this.dropdown.renderLoading();\r\n    });\r\n\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    // Événement de recherche\r\n    this.events.on('search', async (query: string) => {\r\n      this.searchService.search(query);\r\n    });\r\n\r\n    // Événement de sélection\r\n    this.events.on('select', async (item: SelectedItem) => {\r\n      await this.handleSelect(item);\r\n    });\r\n\r\n    // Événement de suppression\r\n    this.events.on('remove', async (item: SelectedItem) => {\r\n      this.tagList.remove(item);\r\n      this.updateHiddenInput();\r\n      this.input.focus();\r\n      \r\n      const onRemove = this.config.get('onRemove');\r\n      if (onRemove) {\r\n        await onRemove(item);\r\n      }\r\n\r\n      const onChange = this.config.get('onChange');\r\n      if (onChange) {\r\n        await onChange(this.getValue());\r\n      }\r\n    });\r\n\r\n    // Événements d'ouverture/fermeture\r\n    this.events.on('open', async () => {\r\n      this.input.setAriaExpanded(true);\r\n      \r\n      const callback = this.config.get('onOpen');\r\n      if (callback) {\r\n        await callback();\r\n      }\r\n    });\r\n\r\n    this.events.on('close', async () => {\r\n      this.dropdown.close();\r\n      this.input.setAriaExpanded(false);\r\n      \r\n      const callback = this.config.get('onClose');\r\n      if (callback) {\r\n        await callback();\r\n      }\r\n    });\r\n\r\n    // ========================================\r\n    // FERMER AU CLIC EXTÉRIEUR - VERSION ROBUSTE\r\n    // ========================================\r\n    this.clickHandler = (e: Event) => {\r\n      const mouseEvent = e as MouseEvent;\r\n      \r\n      // Utiliser composedPath pour gérer le Shadow DOM\r\n      const path = mouseEvent.composedPath ? mouseEvent.composedPath() : [];\r\n      \r\n      // Vérifier si le clic est dans notre composant\r\n      let isInside = false;\r\n      \r\n      // Méthode 1: Vérifier dans le composedPath\r\n      for (const element of path) {\r\n        if (element === this.container) {\r\n          isInside = true;\r\n          break;\r\n        }\r\n      }\r\n      \r\n      // Méthode 2: Fallback avec contains (pour les navigateurs plus anciens)\r\n      if (!isInside && mouseEvent.target) {\r\n        isInside = this.container.contains(mouseEvent.target as Node);\r\n      }\r\n      \r\n      // Si le clic est en dehors ET que le dropdown est ouvert, le fermer\r\n      if (!isInside && this.dropdown.isDropdownOpen()) {\r\n        this.dropdown.close();\r\n      }\r\n    };\r\n\r\n    // Attacher au document en phase de capture pour intercepter tous les clics\r\n    // true = capture phase (important pour Shadow DOM)\r\n    document.addEventListener('click', this.clickHandler as EventListener, true);\r\n\r\n    // ========================================\r\n    // BONUS: Fermer au blur avec délai\r\n    // ========================================\r\n    this.input.getElement().addEventListener('blur', () => {\r\n      // Petit délai pour permettre aux clics sur les options de fonctionner\r\n      setTimeout(() => {\r\n        // Vérifier si le focus n'est pas dans le composant\r\n        const activeElement = document.activeElement;\r\n        const shadowActiveElement = this.rootElement instanceof ShadowRoot \r\n          ? this.rootElement.activeElement \r\n          : null;\r\n        \r\n        const hasFocus = this.container.contains(activeElement as Node) ||\r\n                        (shadowActiveElement && this.container.contains(shadowActiveElement as Node));\r\n        \r\n        if (!hasFocus && this.dropdown.isDropdownOpen()) {\r\n          this.dropdown.close();\r\n        }\r\n      }, 200);\r\n    });\r\n  }\r\n\r\n  private async handleSelect(item: SelectedItem): Promise<void> {\r\n    const multiple = this.config.get('multiple');\r\n\r\n    if (!multiple) {\r\n      this.tagList.clear();\r\n    }\r\n\r\n    if (!this.tagList.canAddMore()) {\r\n      console.warn('Maximum number of items reached');\r\n      return;\r\n    }\r\n\r\n    if (this.tagList.hasItem(item)) {\r\n      console.log('Item already selected, skipping:', item);\r\n      return;\r\n    }\r\n\r\n    const added = this.tagList.add(item);\r\n    \r\n    if (added) {\r\n      this.updateHiddenInput();\r\n\r\n      if (this.config.get('clearOnSelect')) {\r\n        this.input.clear();\r\n      }\r\n\r\n      if (this.config.get('closeOnSelect')) {\r\n        this.dropdown.close();\r\n      }\r\n\r\n      this.input.focus();\r\n\r\n      const onChange = this.config.get('onChange');\r\n      if (onChange) {\r\n        await onChange(this.getValue());\r\n      }\r\n\r\n      const onSelect = this.config.get('onSelect');\r\n      if (onSelect) {\r\n        await onSelect(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateHiddenInput(): void {\r\n    const items = this.tagList.getItems();\r\n    const values = items.map((item) => item.value);\r\n    this.hiddenInput.value = JSON.stringify(values);\r\n    this.originalInput.value = this.hiddenInput.value;\r\n  }\r\n\r\n  private loadCustomCSS(): void {\r\n    const cssUrl = this.config.get('cssUrl');\r\n    if (cssUrl) {\r\n      const link = document.createElement('link');\r\n      link.rel = 'stylesheet';\r\n      link.href = cssUrl;\r\n      \r\n      if (this.rootElement instanceof ShadowRoot) {\r\n        this.rootElement.appendChild(link);\r\n      } else {\r\n        document.head.appendChild(link);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Public API\r\n\r\n  public getValue(): SelectedItem[] {\r\n    return this.tagList.getItems();\r\n  }\r\n\r\n  public setValue(items: SelectedItem[]): void {\r\n    this.tagList.clear();\r\n    items.forEach((item) => {\r\n      if (this.tagList.canAddMore()) {\r\n        this.tagList.add(item);\r\n      }\r\n    });\r\n    this.updateHiddenInput();\r\n  }\r\n\r\n  public clear(): void {\r\n    this.tagList.clear();\r\n    this.input.clear();\r\n    this.dropdown.close();\r\n    this.updateHiddenInput();\r\n    this.searchService.reset();\r\n  }\r\n\r\n  public disable(): void {\r\n    this.isDisabled = true;\r\n    this.input.disable();\r\n    this.controlElement.classList.add('disabled');\r\n    this.dropdown.close();\r\n  }\r\n\r\n  public enable(): void {\r\n    this.isDisabled = false;\r\n    this.input.enable();\r\n    this.controlElement.classList.remove('disabled');\r\n  }\r\n\r\n  public destroy(): void {\r\n    // ========================================\r\n    // IMPORTANT: Retirer le click handler\r\n    // ========================================\r\n    if (this.clickHandler) {\r\n      document.removeEventListener('click', this.clickHandler as EventListener, true);\r\n    }\r\n    \r\n    this.searchService.abort();\r\n    this.events.clear();\r\n    this.input.destroy();\r\n    this.dropdown.destroy();\r\n    this.tagList.destroy();\r\n    this.container.remove();\r\n    this.originalInput.style.display = '';\r\n  }\r\n\r\n  public open(): void {\r\n    if (!this.isDisabled) {\r\n      const query = this.input.getValue();\r\n      if (query) {\r\n        this.searchService.searchImmediate(query);\r\n      }\r\n    }\r\n  }\r\n\r\n  public close(): void {\r\n    this.dropdown.close();\r\n  }\r\n\r\n  public addItem(item: SelectedItem): void {\r\n    if (this.tagList.canAddMore()) {\r\n      this.tagList.add(item);\r\n      this.updateHiddenInput();\r\n    }\r\n  }\r\n\r\n  public removeItem(item: SelectedItem): void {\r\n    this.tagList.remove(item);\r\n    this.updateHiddenInput();\r\n  }\r\n\r\n  public clearCache(): void {\r\n    this.dataService.clearCache();\r\n  }\r\n}","import { ComboSelect } from '@core/ComboSelect';\r\nimport type { ComboSelectConfig, SelectedItem } from '../types/index';\r\nimport styles from '../styles/comboselect.css?inline';\r\n\r\nexport class ComboSelectElement extends HTMLElement {\r\n  private comboSelect?: ComboSelect;\r\n  private inputElement?: HTMLInputElement;\r\n  private _dataSource?: any[] | (() => any[] | Promise<any[]>);\r\n\r\n  constructor() {\r\n    super();\r\n    this.attachShadow({ mode: 'open' });\r\n  }\r\n\r\n  static get observedAttributes() {\r\n    return [\r\n      'placeholder',\r\n      'multiple',\r\n      'max-items',\r\n      'min-chars',\r\n      'debounce-delay',\r\n      'label-suggestion',\r\n      'value-suggestion',\r\n      'increment-value-size',\r\n      'disabled',\r\n      'autocomplete-url',\r\n      'results-key',\r\n      'close-on-select',\r\n    ];\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.render();\r\n    this.initComboSelect();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.comboSelect?.destroy();\r\n  }\r\n\r\n  attributeChangedCallback(_name: string, oldValue: string, newValue: string) {\r\n    if (oldValue !== newValue && this.comboSelect) {\r\n      this.updateConfig();\r\n    }\r\n  }\r\n\r\n  private render() {\r\n    if (!this.shadowRoot) return;\r\n\r\n    // Créer le style\r\n    const styleEl = document.createElement('style');\r\n    styleEl.textContent = styles;\r\n\r\n    // Créer l'input\r\n    this.inputElement = document.createElement('input');\r\n    this.inputElement.type = 'text';\r\n    this.inputElement.className = 'comboselect-internal-input';\r\n    this.inputElement.id = 'combo-input';\r\n\r\n    // Ajouter au Shadow DOM\r\n    this.shadowRoot.appendChild(styleEl);\r\n    this.shadowRoot.appendChild(this.inputElement);\r\n  }\r\n\r\n  private initComboSelect() {\r\n    if (!this.inputElement || !this.shadowRoot) return;\r\n\r\n    const config = this.buildConfig();\r\n    const inputEl = this.shadowRoot.querySelector('#combo-input') as HTMLInputElement;\r\n\r\n    if (!inputEl) return;\r\n\r\n    // Passer directement l'élément HTMLInputElement\r\n    this.comboSelect = new ComboSelect(inputEl, config);\r\n\r\n    console.log('✅ ComboSelect initialized with config:', config);\r\n  }\r\n\r\n  private buildConfig(): Partial<ComboSelectConfig> {\r\n    const config: Partial<ComboSelectConfig> = {\r\n      placeholder: this.getAttribute('placeholder') || 'Sélectionner...',\r\n      multiple: this.hasAttribute('multiple'),\r\n      labelSuggestion: this.getAttribute('label-suggestion') || 'label',\r\n      valueSuggestion: this.getAttribute('value-suggestion') || null,\r\n    };\r\n\r\n    // Max items\r\n    const maxItems = this.getAttribute('max-items');\r\n    if (maxItems) config.maxItems = parseInt(maxItems, 10);\r\n\r\n    // Min chars\r\n    const minChars = this.getAttribute('min-chars');\r\n    if (minChars) config.minChars = parseInt(minChars, 10);\r\n\r\n    // Debounce delay\r\n    const debounceDelay = this.getAttribute('debounce-delay');\r\n    if (debounceDelay) config.debounceDelay = parseInt(debounceDelay, 10);\r\n\r\n    // Increment value size\r\n    const incrementValueSize = this.getAttribute('increment-value-size');\r\n    if (incrementValueSize) config.incrementValueSize = parseInt(incrementValueSize, 10);\r\n\r\n    // Data source depuis la propriété JavaScript\r\n    if (this._dataSource) {\r\n      config.dataSource = this._dataSource;\r\n      console.log('📦 DataSource set:', this._dataSource);\r\n    }\r\n\r\n    // Autocomplete URL\r\n    const autocompleteUrl = this.getAttribute('autocomplete-url');\r\n    if (autocompleteUrl) {\r\n      config.autocompleteUrl = autocompleteUrl;\r\n      console.log('🌐 Autocomplete URL:', autocompleteUrl);\r\n    }\r\n\r\n    // Results key\r\n    const resultsKey = this.getAttribute('results-key');\r\n    if (resultsKey) {\r\n      config.resultsKey = resultsKey;\r\n    }\r\n\r\n    // Close on select\r\n    const closeOnSelect = this.getAttribute('close-on-select');\r\n    if (closeOnSelect !== null) {\r\n      config.closeOnSelect = closeOnSelect === 'true';\r\n    }\r\n\r\n    // Ajouter les callbacks pour émettre des événements\r\n    config.onSelect = (item: SelectedItem) => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-select', { \r\n        detail: item,\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onChange = (items: SelectedItem[]) => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-change', { \r\n        detail: items,\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n      this.dispatchEvent(new CustomEvent('change', { \r\n        detail: items,\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onRemove = (item: SelectedItem) => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-remove', { \r\n        detail: item,\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onOpen = () => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-open', { \r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onClose = () => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-close', { \r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onSearch = (query: string) => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-search', { \r\n        detail: { query },\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onLoad = (data: any[]) => {\r\n      this.dispatchEvent(new CustomEvent('comboselect-load', { \r\n        detail: data,\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    config.onError = (error: Error) => {\r\n      console.error('❌ ComboSelect error:', error);\r\n      this.dispatchEvent(new CustomEvent('comboselect-error', { \r\n        detail: error,\r\n        bubbles: true,\r\n        composed: true \r\n      }));\r\n    };\r\n\r\n    return config;\r\n  }\r\n\r\n  private updateConfig() {\r\n    // Reconstruire et mettre à jour la config\r\n    if (this.comboSelect) {\r\n      this.comboSelect.destroy();\r\n      this.initComboSelect();\r\n    }\r\n  }\r\n\r\n  // API publique\r\n  get dataSource(): any[] | (() => any[] | Promise<any[]>) | undefined {\r\n    return this._dataSource;\r\n  }\r\n\r\n  set dataSource(value: any[] | (() => any[] | Promise<any[]>) | undefined) {\r\n    console.log('🔧 Setting dataSource:', value);\r\n    this._dataSource = value;\r\n    \r\n    // Si ComboSelect est déjà initialisé, le recréer avec les nouvelles données\r\n    if (this.comboSelect) {\r\n      console.log('♻️ Recreating ComboSelect with new dataSource');\r\n      this.updateConfig();\r\n    }\r\n  }\r\n\r\n  getValue(): SelectedItem[] {\r\n    return this.comboSelect?.getValue() || [];\r\n  }\r\n\r\n  setValue(items: SelectedItem[]): void {\r\n    this.comboSelect?.setValue(items);\r\n  }\r\n\r\n  clear(): void {\r\n    this.comboSelect?.clear();\r\n  }\r\n\r\n  open(): void {\r\n    this.comboSelect?.open();\r\n  }\r\n\r\n  close(): void {\r\n    this.comboSelect?.close();\r\n  }\r\n\r\n  get disabled(): boolean {\r\n    return this.hasAttribute('disabled');\r\n  }\r\n\r\n  set disabled(value: boolean) {\r\n    if (value) {\r\n      this.setAttribute('disabled', '');\r\n      this.comboSelect?.disable();\r\n    } else {\r\n      this.removeAttribute('disabled');\r\n      this.comboSelect?.enable();\r\n    }\r\n  }\r\n}\r\n\r\n// Définir le custom element\r\nif (!customElements.get('combo-select')) {\r\n  customElements.define('combo-select', ComboSelectElement);\r\n}"],"names":["Validators","config","url","_Config","userConfig","__publicField","key","updates","Config","EventEmitter","event","callback","callbacks","args","error","DEFAULTS","CSS_CLASSES","EVENTS","KEYBOARD_KEYS","ARIA_ATTRIBUTES","ERROR_MESSAGES","DEFAULT_HTTP_HEADERS","TIMEOUTS","DataService","query","dataSource","result","autocompleteUrl","searchParam","httpMethod","httpHeaders","cacheKey","fetchOptions","method","param","separator","timeoutId","response","data","results","resultsKey","transformResponse","keys","searchTerm","labelSuggestion","labelKey","item","value","SearchService","dataService","minChars","debounceDelay","filteredData","suggestions","errorObj","callbackError","valueSuggestion","valueKey","label","DOMHelpers","tag","className","attributes","element","text","div","rect","parent","child","node","RenderService","customRender","debounce","func","wait","timeout","later","Input","events","expanded","Dropdown","renderService","direction","suggestion","index","option","e","maxIndex","newIndex","Tag","renderContent","content","removeBtn","TagList","container","existingTagIndex","existingValue","newValue","incrementSize","remainingCount","count","maxItems","ComboSelect","selector","options","el","fullConfig","control","selected","selectedValues","filteredSuggestions","onRemove","onChange","mouseEvent","path","isInside","activeElement","shadowActiveElement","onSelect","values","cssUrl","link","items","ComboSelectElement","_name","oldValue","styleEl","styles","inputEl","incrementValueSize","closeOnSelect"],"mappings":"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"}