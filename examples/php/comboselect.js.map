{"version":3,"file":"comboselect.js","sources":["../src/utils/Validators.ts","../src/core/Config.ts","../src/core/EventEmitter.ts","../src/services/DataService.ts","../src/services/SearchService.ts","../src/utils/DOMHelpers.ts","../src/services/RenderService.ts","../src/utils/Debounce.ts","../src/components/Input.ts","../src/components/Dropdown.ts","../src/components/Tag.ts","../src/components/TagList.ts","../src/core/ComboSelect.ts"],"sourcesContent":["import type { ComboSelectConfig } from '../types/index';\r\n\r\nexport class Validators {\r\n  static validateConfig(config: Partial<ComboSelectConfig>): void {\r\n    if (config.maxItems !== undefined && config.maxItems < 1) {\r\n      throw new Error('maxItems must be greater than 0');\r\n    }\r\n\r\n    if (config.minChars !== undefined && config.minChars < 0) {\r\n      throw new Error('minChars cannot be negative');\r\n    }\r\n\r\n    if (config.debounceDelay !== undefined && config.debounceDelay < 0) {\r\n      throw new Error('debounceDelay cannot be negative');\r\n    }\r\n\r\n    if (config.incrementValueSize !== undefined && config.incrementValueSize < 1) {\r\n      throw new Error('incrementValueSize must be greater than 0');\r\n    }\r\n\r\n    if (!config.autocompleteUrl && !config.dataSource) {\r\n      console.warn('Neither autocompleteUrl nor dataSource provided. ComboSelect will work in manual mode.');\r\n    }\r\n\r\n    if (config.autocompleteUrl && config.dataSource) {\r\n      console.warn('Both autocompleteUrl and dataSource provided. dataSource will take precedence.');\r\n    }\r\n  }\r\n\r\n  static validateUrl(url: string): boolean {\r\n    try {\r\n      new URL(url);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}","import type { ComboSelectConfig } from '../types/index';\r\nimport { Validators } from '@utils/Validators';\r\n\r\nexport class Config {\r\n  private config: ComboSelectConfig;\r\n\r\n  private static readonly DEFAULT_CONFIG: ComboSelectConfig = {\r\n    placeholder: 'S√©lectionner...',\r\n    minChars: 1,\r\n    debounceDelay: 300,\r\n    httpMethod: 'GET',\r\n    searchParam: 'q',\r\n    labelSuggestion: 'label',\r\n    valueSuggestion: null,\r\n    multiple: false,\r\n    closeOnSelect: true,\r\n    clearOnSelect: false,\r\n    allowCreate: false,\r\n    httpHeaders: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  };\r\n\r\n  constructor(userConfig: Partial<ComboSelectConfig>) {\r\n    Validators.validateConfig(userConfig);\r\n    \r\n    this.config = {\r\n      ...Config.DEFAULT_CONFIG,\r\n      ...userConfig,\r\n    };\r\n  }\r\n\r\n  get<K extends keyof ComboSelectConfig>(key: K): ComboSelectConfig[K] {\r\n    return this.config[key];\r\n  }\r\n\r\n  getAll(): Readonly<ComboSelectConfig> {\r\n    return Object.freeze({ ...this.config });\r\n  }\r\n\r\n  update(updates: Partial<ComboSelectConfig>): void {\r\n    Validators.validateConfig(updates);\r\n    this.config = {\r\n      ...this.config,\r\n      ...updates,\r\n    };\r\n  }\r\n}","import type { ComboSelectEvent } from '../types/index';\r\n\r\nexport class EventEmitter {\r\n  private events: Map<ComboSelectEvent, Set<(...args: any[]) => void>>;\r\n\r\n  constructor() {\r\n    this.events = new Map();\r\n  }\r\n\r\n  on(event: ComboSelectEvent, callback: (...args: any[]) => void): void {\r\n    if (!this.events.has(event)) {\r\n      this.events.set(event, new Set());\r\n    }\r\n    this.events.get(event)!.add(callback);\r\n  }\r\n\r\n  off(event: ComboSelectEvent, callback: (...args: any[]) => void): void {\r\n    const callbacks = this.events.get(event);\r\n    if (callbacks) {\r\n      callbacks.delete(callback);\r\n    }\r\n  }\r\n\r\n  emit(event: ComboSelectEvent, ...args: any[]): void {\r\n    const callbacks = this.events.get(event);\r\n    if (callbacks) {\r\n      callbacks.forEach((callback) => {\r\n        try {\r\n          callback(...args);\r\n        } catch (error) {\r\n          console.error(`Error in event handler for \"${event}\":`, error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.events.clear();\r\n  }\r\n}","import { Config } from '@core/Config';\r\n\r\nexport class DataService {\r\n  private config: Config;\r\n  private abortController?: AbortController;\r\n  private cache: Map<string, any[]>;\r\n\r\n  constructor(config: Config) {\r\n    this.config = config;\r\n    this.cache = new Map();\r\n  }\r\n\r\n  async fetch(query: string): Promise<any[]> {\r\n    // Si dataSource est d√©fini, l'utiliser en priorit√©\r\n    const dataSource = this.config.get('dataSource');\r\n    if (dataSource) {\r\n      return this.fetchFromDataSource(query, dataSource);\r\n    }\r\n\r\n    // Sinon utiliser autocompleteUrl\r\n    const url = this.config.get('autocompleteUrl');\r\n    if (!url) {\r\n      return [];\r\n    }\r\n\r\n    return this.fetchFromUrl(query, url);\r\n  }\r\n\r\n  private async fetchFromDataSource(\r\n    query: string,\r\n    dataSource: any[] | (() => any[] | Promise<any[]>)\r\n  ): Promise<any[]> {\r\n    let data: any[];\r\n\r\n    if (typeof dataSource === 'function') {\r\n      data = await dataSource();\r\n    } else {\r\n      data = dataSource;\r\n    }\r\n\r\n    // Filtrer localement\r\n    const labelKey = this.config.get('labelSuggestion') || 'label';\r\n    const queryLower = query.toLowerCase();\r\n\r\n    return data.filter((item) => {\r\n      const label = this.getNestedValue(item, labelKey);\r\n      return String(label).toLowerCase().includes(queryLower);\r\n    });\r\n  }\r\n\r\n  private async fetchFromUrl(query: string, url: string): Promise<any[]> {\r\n    // V√©rifier le cache\r\n    const cacheKey = `${url}:${query}`;\r\n    if (this.cache.has(cacheKey)) {\r\n      return this.cache.get(cacheKey)!;\r\n    }\r\n\r\n    // Annuler la requ√™te pr√©c√©dente\r\n    this.abortController?.abort();\r\n    this.abortController = new AbortController();\r\n\r\n    const httpMethod = this.config.get('httpMethod') || 'GET';\r\n    const searchParam = this.config.get('searchParam') || 'q';\r\n    const headers = this.config.get('httpHeaders') || {};\r\n\r\n    try {\r\n      let fetchUrl = url;\r\n      let options: RequestInit = {\r\n        method: httpMethod,\r\n        headers,\r\n        signal: this.abortController.signal,\r\n      };\r\n\r\n      if (httpMethod === 'GET') {\r\n        const separator = url.includes('?') ? '&' : '?';\r\n        fetchUrl = `${url}${separator}${searchParam}=${encodeURIComponent(query)}`;\r\n      } else {\r\n        options.body = JSON.stringify({ [searchParam]: query });\r\n      }\r\n\r\n      const response = await fetch(fetchUrl, options);\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      // NOUVEAU : Extraire les r√©sultats selon la configuration\r\n      const results = this.extractResults(data);\r\n\r\n      // Mettre en cache\r\n      this.cache.set(cacheKey, results);\r\n\r\n      return results;\r\n    } catch (error) {\r\n      if (error instanceof Error && error.name === 'AbortError') {\r\n        return [];\r\n      }\r\n      console.error('Error fetching data:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * NOUVEAU : Extrait les r√©sultats d'une r√©ponse API selon la configuration\r\n   */\r\n  private extractResults(data: any): any[] {\r\n    // Si une fonction de transformation personnalis√©e est d√©finie\r\n    const transformResponse = this.config.get('transformResponse');\r\n    if (transformResponse) {\r\n      return transformResponse(data);\r\n    }\r\n\r\n    // Si la r√©ponse est d√©j√† un tableau\r\n    if (Array.isArray(data)) {\r\n      return data;\r\n    }\r\n\r\n    // Utiliser resultsKey pour extraire les donn√©es\r\n    const resultsKey = this.config.get('resultsKey');\r\n    \r\n    if (resultsKey) {\r\n      // Si c'est un tableau de cl√©s (pour chemins imbriqu√©s)\r\n      if (Array.isArray(resultsKey)) {\r\n        let results = data;\r\n        for (const key of resultsKey) {\r\n          results = results?.[key];\r\n          if (!results) break;\r\n        }\r\n        return Array.isArray(results) ? results : [];\r\n      }\r\n      \r\n      // Si c'est une seule cl√© (peut contenir des points pour chemins imbriqu√©s)\r\n      const results = this.getNestedValue(data, resultsKey);\r\n      return Array.isArray(results) ? results : [];\r\n    }\r\n\r\n    // Essayer les cl√©s communes par d√©faut\r\n    const commonKeys = ['results', 'items', 'data', 'list', 'records', 'rows'];\r\n    for (const key of commonKeys) {\r\n      if (data[key] && Array.isArray(data[key])) {\r\n        return data[key];\r\n      }\r\n    }\r\n\r\n    // Si aucune cl√© ne fonctionne et que c'est un objet avec une seule propri√©t√© tableau\r\n    const keys = Object.keys(data);\r\n    if (keys.length === 1 && Array.isArray(data[keys[0]!])) {\r\n      return data[keys[0]!];\r\n    }\r\n\r\n    // Dernier recours : retourner un tableau vide\r\n    console.warn('Could not extract results from API response. Consider using resultsKey or transformResponse config.', data);\r\n    return [];\r\n  }\r\n\r\n  private getNestedValue(obj: any, path: string): any {\r\n    return path.split('.').reduce((current, key) => current?.[key], obj);\r\n  }\r\n\r\n  clearCache(): void {\r\n    this.cache.clear();\r\n  }\r\n\r\n  abort(): void {\r\n    this.abortController?.abort();\r\n  }\r\n}","import type { SuggestionItem, SelectedItem } from '../types/index';\r\nimport { Config } from '@core/Config';\r\n\r\nexport class SearchService {\r\n  private config: Config;\r\n\r\n  constructor(config: Config) {\r\n    this.config = config;\r\n  }\r\n\r\n  parseResults(data: any[]): SuggestionItem[] {\r\n\r\n\r\n    const labelKey = this.config.get('labelSuggestion') || 'label';\r\n    const valueKey = this.config.get('valueSuggestion');\r\n\r\n    const results = data.map((item) => {\r\n      const label = this.getNestedValue(item, labelKey);\r\n      const value = valueKey ? this.getNestedValue(item, valueKey) : item;\r\n\r\n     \r\n\r\n      return {\r\n        label: String(label),\r\n        value,\r\n        original: item,\r\n      };\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  filterSelected(suggestions: SuggestionItem[], selected: SelectedItem[]): SuggestionItem[] {\r\n    if (!this.config.get('multiple')) {\r\n      return suggestions;\r\n    }\r\n\r\n    const selectedValues = new Set(selected.map((item) => JSON.stringify(item.value)));\r\n\r\n    const filtered = suggestions.filter((suggestion) => {\r\n      return !selectedValues.has(JSON.stringify(suggestion.value));\r\n    });\r\n\r\n\r\n    return filtered;\r\n  }\r\n\r\n  private getNestedValue(obj: any, path: string): any {\r\n  \r\n    const result = path.split('.').reduce((current, key) => {\r\n\r\n      return current?.[key];\r\n    }, obj);\r\n \r\n    return result;\r\n  }\r\n}","export class DOMHelpers {\r\n    static createElement<K extends keyof HTMLElementTagNameMap>(\r\n      tag: K,\r\n      className?: string,\r\n      attributes?: Record<string, string>\r\n    ): HTMLElementTagNameMap[K] {\r\n      const element = document.createElement(tag);\r\n      \r\n      if (className) {\r\n        element.className = className;\r\n      }\r\n      \r\n      if (attributes) {\r\n        Object.entries(attributes).forEach(([key, value]) => {\r\n          element.setAttribute(key, value);\r\n        });\r\n      }\r\n      \r\n      return element;\r\n    }\r\n  \r\n    static removeAllChildren(element: HTMLElement): void {\r\n      while (element.firstChild) {\r\n        element.removeChild(element.firstChild);\r\n      }\r\n    }\r\n  \r\n    static escapeHtml(text: string): string {\r\n      const div = document.createElement('div');\r\n      div.textContent = text;\r\n      return div.innerHTML;\r\n    }\r\n  \r\n    static getOffset(element: HTMLElement): { top: number; left: number } {\r\n      const rect = element.getBoundingClientRect();\r\n      return {\r\n        top: rect.top + window.scrollY,\r\n        left: rect.left + window.scrollX,\r\n      };\r\n    }\r\n  \r\n    static isDescendant(parent: HTMLElement, child: HTMLElement): boolean {\r\n      let node: HTMLElement | null = child;\r\n      while (node) {\r\n        if (node === parent) {\r\n          return true;\r\n        }\r\n        node = node.parentElement;\r\n      }\r\n      return false;\r\n    }\r\n  }","import type { SuggestionItem, SelectedItem } from '../types/index';\r\nimport { Config } from '@core/Config';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class RenderService {\r\n  private config: Config;\r\n\r\n  constructor(config: Config) {\r\n    this.config = config;\r\n  }\r\n\r\n  renderSuggestion(item: SuggestionItem): string {\r\n    const customRender = this.config.get('renderSuggestion');\r\n    \r\n    if (customRender) {\r\n      return customRender(item.original);\r\n    }\r\n\r\n    return DOMHelpers.escapeHtml(item.label);\r\n  }\r\n\r\n  renderTag(item: SelectedItem): string {\r\n    const customRender = this.config.get('renderTag');\r\n    \r\n    if (customRender) {\r\n      return customRender(item);\r\n    }\r\n\r\n    return DOMHelpers.escapeHtml(item.label);\r\n  }\r\n\r\n  renderNoResults(): string {\r\n    return '<div class=\"comboselect-no-results\">Aucun r√©sultat trouv√©</div>';\r\n  }\r\n\r\n  renderLoading(): string {\r\n    return `\r\n      <div class=\"comboselect-loading\">\r\n        <span class=\"comboselect-loading-spinner\"></span>\r\n        <span>Chargement...</span>\r\n      </div>\r\n    `;\r\n  }\r\n}","export function debounce<T extends (...args: any[]) => any>(\r\n    func: T,\r\n    wait: number\r\n  ): (...args: Parameters<T>) => void {\r\n    let timeout: ReturnType<typeof setTimeout> | null = null;\r\n  \r\n    return function executedFunction(...args: Parameters<T>) {\r\n      const later = () => {\r\n        timeout = null;\r\n        func(...args);\r\n      };\r\n  \r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n      }\r\n      timeout = setTimeout(later, wait);\r\n    };\r\n  }","import { Config } from '@core/Config';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\nimport { debounce } from '@utils/Debounce';\r\n\r\nexport class Input {\r\n  private element: HTMLInputElement;\r\n  private config: Config;\r\n  private events: EventEmitter;\r\n  private debouncedSearch: (query: string) => void;\r\n\r\n  constructor(config: Config, events: EventEmitter) {\r\n    this.config = config;\r\n    this.events = events;\r\n    this.element = this.create();\r\n    this.debouncedSearch = debounce(\r\n      (query: string) => this.handleSearch(query),\r\n      config.get('debounceDelay') || 300\r\n    );\r\n    this.attachEvents();\r\n  }\r\n\r\n  private create(): HTMLInputElement {\r\n    const input = DOMHelpers.createElement('input', 'comboselect-input', {\r\n      type: 'text',\r\n      placeholder: this.config.get('placeholder') || '',\r\n      autocomplete: 'off',\r\n      role: 'combobox',\r\n      'aria-autocomplete': 'list',\r\n      'aria-expanded': 'false',\r\n      'aria-haspopup': 'listbox',\r\n    });\r\n\r\n    return input;\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    this.element.addEventListener('input', (e) => {\r\n      const target = e.target as HTMLInputElement;\r\n      const query = target.value.trim();\r\n      const minChars = this.config.get('minChars') || 1;\r\n\r\n      if (query.length >= minChars) {\r\n        this.debouncedSearch(query);\r\n      } else if (query.length === 0) {\r\n        this.events.emit('close');\r\n      }\r\n    });\r\n\r\n    this.element.addEventListener('focus', () => {\r\n      const query = this.element.value.trim();\r\n      const minChars = this.config.get('minChars') || 1;\r\n      \r\n      if (query.length >= minChars) {\r\n        this.handleSearch(query);\r\n      }\r\n    });\r\n\r\n    this.element.addEventListener('keydown', (e) => {\r\n      this.handleKeydown(e);\r\n    });\r\n  }\r\n\r\n  private handleSearch(query: string): void {\r\n    this.events.emit('search', query);\r\n  }\r\n\r\n  private handleKeydown(e: KeyboardEvent): void {\r\n    switch (e.key) {\r\n      case 'ArrowDown':\r\n        e.preventDefault();\r\n        this.events.emit('navigate', 'down');\r\n        break;\r\n      case 'ArrowUp':\r\n        e.preventDefault();\r\n        this.events.emit('navigate', 'up');\r\n        break;\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        this.events.emit('navigate', 'select');\r\n        break;\r\n      case 'Escape':\r\n        e.preventDefault();\r\n        this.events.emit('close');\r\n        break;\r\n    }\r\n  }\r\n\r\n  getElement(): HTMLInputElement {\r\n    return this.element;\r\n  }\r\n\r\n  getValue(): string {\r\n    return this.element.value;\r\n  }\r\n\r\n  setValue(value: string): void {\r\n    this.element.value = value;\r\n  }\r\n\r\n  clear(): void {\r\n    this.element.value = '';\r\n  }\r\n\r\n  focus(): void {\r\n    this.element.focus();\r\n  }\r\n\r\n  disable(): void {\r\n    this.element.disabled = true;\r\n  }\r\n\r\n  enable(): void {\r\n    this.element.disabled = false;\r\n  }\r\n\r\n  setAriaExpanded(expanded: boolean): void {\r\n    this.element.setAttribute('aria-expanded', String(expanded));\r\n  }\r\n\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}","import type { SuggestionItem } from '../types/index';\r\nimport { Config } from '@core/Config';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\nimport { RenderService } from '@services/RenderService';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class Dropdown {\r\n  private element: HTMLElement;\r\n  // Suppression de la ligne inutilis√©e 'config'\r\n  private events: EventEmitter;\r\n  private renderService: RenderService;\r\n  private suggestions: SuggestionItem[];\r\n  private focusedIndex: number;\r\n  private isOpen: boolean;\r\n\r\n  constructor(_config: Config, events: EventEmitter, renderService: RenderService) {\r\n    // On n'a pas besoin de stocker config car on ne l'utilise pas dans cette classe\r\n    this.events = events;\r\n    this.renderService = renderService;\r\n    this.suggestions = [];\r\n    this.focusedIndex = -1;\r\n    this.isOpen = false;\r\n    this.element = this.create();\r\n    this.attachEvents();\r\n  }\r\n\r\n  private create(): HTMLElement {\r\n    const dropdown = DOMHelpers.createElement('div', 'comboselect-dropdown hidden', {\r\n      role: 'listbox',\r\n    });\r\n\r\n    return dropdown;\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    this.events.on('navigate', (direction: 'up' | 'down' | 'select') => {\r\n      this.handleNavigation(direction);\r\n    });\r\n  }\r\n\r\n  open(): void {\r\n    if (!this.isOpen) {\r\n      this.element.classList.remove('hidden');\r\n      this.isOpen = true;\r\n      this.events.emit('open');\r\n    }\r\n  }\r\n\r\n  close(): void {\r\n    if (this.isOpen) {\r\n      this.element.classList.add('hidden');\r\n      this.isOpen = false;\r\n      this.focusedIndex = -1;\r\n      this.events.emit('close');\r\n    }\r\n  }\r\n\r\n  render(suggestions: SuggestionItem[]): void {\r\n    console.log('üé® Dropdown.render called with suggestions:', suggestions);\r\n    console.log('üìä Number of suggestions:', suggestions.length);\r\n    \r\n    this.suggestions = suggestions;\r\n    this.focusedIndex = -1;\r\n    DOMHelpers.removeAllChildren(this.element);\r\n\r\n    if (suggestions.length === 0) {\r\n      console.log('‚ö†Ô∏è No suggestions - showing \"no results\" message');\r\n      this.element.innerHTML = this.renderService.renderNoResults();\r\n      this.open();\r\n      return;\r\n    }\r\n\r\n    console.log('‚úÖ Rendering', suggestions.length, 'suggestions');\r\n    suggestions.forEach((suggestion, index) => {\r\n      console.log(`  ‚Üí Creating option ${index}:`, suggestion);\r\n      const option = this.createOption(suggestion, index);\r\n      this.element.appendChild(option);\r\n    });\r\n\r\n    this.open();\r\n  }\r\n\r\n  renderLoading(): void {\r\n    DOMHelpers.removeAllChildren(this.element);\r\n    this.element.innerHTML = this.renderService.renderLoading();\r\n    this.open();\r\n  }\r\n\r\n  private createOption(suggestion: SuggestionItem, index: number): HTMLElement {\r\n    const option = DOMHelpers.createElement('div', 'comboselect-option', {\r\n      role: 'option',\r\n      'data-index': String(index),\r\n    });\r\n\r\n    option.innerHTML = this.renderService.renderSuggestion(suggestion);\r\n\r\n    if (suggestion.disabled) {\r\n      option.classList.add('disabled');\r\n      option.setAttribute('aria-disabled', 'true');\r\n    }\r\n\r\n    option.addEventListener('mousedown', (e) => {\r\n      e.preventDefault(); // Emp√™che la perte de focus de l'input\r\n      if (!suggestion.disabled) {\r\n        this.selectOption(index);\r\n      }\r\n    });\r\n\r\n    option.addEventListener('mouseenter', () => {\r\n      if (!suggestion.disabled) {\r\n        this.focusOption(index);\r\n      }\r\n    });\r\n\r\n    return option;\r\n  }\r\n\r\n  private handleNavigation(direction: 'up' | 'down' | 'select'): void {\r\n    if (!this.isOpen || this.suggestions.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (direction === 'select') {\r\n      if (this.focusedIndex >= 0) {\r\n        this.selectOption(this.focusedIndex);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const maxIndex = this.suggestions.length - 1;\r\n    let newIndex = this.focusedIndex;\r\n\r\n    if (direction === 'down') {\r\n      newIndex = this.focusedIndex < maxIndex ? this.focusedIndex + 1 : 0;\r\n    } else if (direction === 'up') {\r\n      newIndex = this.focusedIndex > 0 ? this.focusedIndex - 1 : maxIndex;\r\n    }\r\n\r\n    // Sauter les options d√©sactiv√©es\r\n    while (this.suggestions[newIndex]?.disabled) {\r\n      if (direction === 'down') {\r\n        newIndex = newIndex < maxIndex ? newIndex + 1 : 0;\r\n      } else {\r\n        newIndex = newIndex > 0 ? newIndex - 1 : maxIndex;\r\n      }\r\n\r\n      // √âviter une boucle infinie si toutes les options sont d√©sactiv√©es\r\n      if (newIndex === this.focusedIndex) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.focusOption(newIndex);\r\n  }\r\n\r\n  private focusOption(index: number): void {\r\n    // Retirer le focus de l'option pr√©c√©dente\r\n    if (this.focusedIndex >= 0) {\r\n      const prevOption = this.element.querySelector(`[data-index=\"${this.focusedIndex}\"]`);\r\n      prevOption?.classList.remove('focused');\r\n    }\r\n\r\n    this.focusedIndex = index;\r\n\r\n    // Ajouter le focus √† la nouvelle option\r\n    const option = this.element.querySelector(`[data-index=\"${index}\"]`);\r\n    if (option) {\r\n      option.classList.add('focused');\r\n      option.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }\r\n\r\n  private selectOption(index: number): void {\r\n    const suggestion = this.suggestions[index];\r\n    if (suggestion && !suggestion.disabled) {\r\n      this.events.emit('select', {\r\n        label: suggestion.label,\r\n        value: suggestion.value,\r\n        original: suggestion.original,\r\n      });\r\n    }\r\n  }\r\n\r\n  getElement(): HTMLElement {\r\n    return this.element;\r\n  }\r\n\r\n  isDropdownOpen(): boolean {\r\n    return this.isOpen;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.close();\r\n    this.element.remove();\r\n  }\r\n}","import type { SelectedItem } from '../types/index';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\n\r\nexport class Tag {\r\n  private element: HTMLElement;\r\n  private item: SelectedItem;\r\n  private events: EventEmitter;\r\n\r\n  constructor(item: SelectedItem, renderContent: string, events: EventEmitter) {\r\n    this.item = item;\r\n    this.events = events;\r\n    this.element = this.create(renderContent);\r\n  }\r\n\r\n  private create(renderContent: string): HTMLElement {\r\n    const tag = DOMHelpers.createElement('span', 'comboselect-tag');\r\n    tag.setAttribute('data-value', JSON.stringify(this.item.value));\r\n    \r\n    const content = DOMHelpers.createElement('span');\r\n    content.innerHTML = renderContent;\r\n    tag.appendChild(content);\r\n\r\n    const removeBtn = DOMHelpers.createElement('button', 'comboselect-tag-remove', {\r\n      type: 'button',\r\n      'aria-label': `Retirer ${this.item.label}`,\r\n    });\r\n    removeBtn.innerHTML = '&times;';\r\n    removeBtn.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      this.remove();\r\n    });\r\n\r\n    tag.appendChild(removeBtn);\r\n\r\n    return tag;\r\n  }\r\n\r\n  private remove(): void {\r\n    this.events.emit('remove', this.item);\r\n    this.element.remove();\r\n  }\r\n\r\n  getElement(): HTMLElement {\r\n    return this.element;\r\n  }\r\n\r\n  getItem(): SelectedItem {\r\n    return this.item;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}","import type { SelectedItem } from '../types/index';\r\nimport { Config } from '@core/Config';\r\nimport { EventEmitter } from '@core/EventEmitter';\r\nimport { RenderService } from '@services/RenderService';\r\nimport { Tag } from './Tag';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class TagList {\r\n  private container: HTMLElement;\r\n  private config: Config;\r\n  private events: EventEmitter;\r\n  private renderService: RenderService;\r\n  private tags: Tag[];\r\n  private counterElement?: HTMLElement;\r\n\r\n  constructor(\r\n    container: HTMLElement,\r\n    config: Config,\r\n    events: EventEmitter,\r\n    renderService: RenderService\r\n  ) {\r\n    this.container = container;\r\n    this.config = config;\r\n    this.events = events;\r\n    this.renderService = renderService;\r\n    this.tags = [];\r\n  }\r\n\r\n  /**\r\n   * MODIFI√â : V√©rifie si l'item existe d√©j√† avant de l'ajouter\r\n   */\r\n/**\r\n   * Ajoute un item ou met en surbrillance s'il existe d√©j√†\r\n   */\r\nadd(item: SelectedItem): boolean {\r\n    // V√©rifier si l'item existe d√©j√†\r\n    const existingTagIndex = this.tags.findIndex((tag) => {\r\n      const existingValue = JSON.stringify(tag.getItem().value);\r\n      const newValue = JSON.stringify(item.value);\r\n      return existingValue === newValue;\r\n    });\r\n\r\n    if (existingTagIndex !== -1) {\r\n      console.warn('Item already selected:', item);\r\n      // Ajouter un effet visuel sur le tag existant\r\n      this.highlightTag(existingTagIndex);\r\n      return false;\r\n    }\r\n\r\n    const renderContent = this.renderService.renderTag(item);\r\n    const tag = new Tag(item, renderContent, this.events);\r\n    this.tags.push(tag);\r\n    this.render();\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * NOUVEAU : Met en surbrillance un tag existant\r\n   */\r\n  private highlightTag(index: number): void {\r\n    const tag = this.tags[index];\r\n    if (!tag) return;\r\n\r\n    const element = tag.getElement();\r\n    \r\n    // Ajouter une classe pour l'animation\r\n    element.classList.add('comboselect-tag-highlight');\r\n    \r\n    // Retirer la classe apr√®s l'animation\r\n    setTimeout(() => {\r\n      element.classList.remove('comboselect-tag-highlight');\r\n    }, 600);\r\n  }\r\n\r\n  /**\r\n   * NOUVEAU : V√©rifie si un item existe d√©j√† dans la liste\r\n   */\r\n  private exists(item: SelectedItem): boolean {\r\n    return this.tags.some((tag) => {\r\n      const existingValue = JSON.stringify(tag.getItem().value);\r\n      const newValue = JSON.stringify(item.value);\r\n      return existingValue === newValue;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * NOUVEAU : M√©thode publique pour v√©rifier l'existence\r\n   */\r\n  public hasItem(item: SelectedItem): boolean {\r\n    return this.exists(item);\r\n  }\r\n\r\n  remove(item: SelectedItem): void {\r\n    const index = this.tags.findIndex(\r\n      (tag) => JSON.stringify(tag.getItem().value) === JSON.stringify(item.value)\r\n    );\r\n\r\n    if (index !== -1) {\r\n      this.tags[index]?.destroy();\r\n      this.tags.splice(index, 1);\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.tags.forEach((tag) => tag.destroy());\r\n    this.tags = [];\r\n    this.render();\r\n  }\r\n\r\n  getItems(): SelectedItem[] {\r\n    return this.tags.map((tag) => tag.getItem());\r\n  }\r\n\r\n  private render(): void {\r\n    DOMHelpers.removeAllChildren(this.container);\r\n\r\n    const incrementSize = this.config.get('incrementValueSize');\r\n\r\n    if (incrementSize && this.tags.length > incrementSize) {\r\n      // Afficher seulement les N premiers tags\r\n      const visibleTags = this.tags.slice(0, incrementSize);\r\n      visibleTags.forEach((tag) => {\r\n        this.container.appendChild(tag.getElement());\r\n      });\r\n\r\n      // Afficher le compteur\r\n      const remainingCount = this.tags.length - incrementSize;\r\n      this.renderCounter(remainingCount);\r\n    } else {\r\n      // Afficher tous les tags\r\n      this.tags.forEach((tag) => {\r\n        this.container.appendChild(tag.getElement());\r\n      });\r\n    }\r\n  }\r\n\r\n  private renderCounter(count: number): void {\r\n    if (this.counterElement) {\r\n      this.counterElement.remove();\r\n    }\r\n\r\n    this.counterElement = DOMHelpers.createElement('span', 'comboselect-tag-counter');\r\n    this.counterElement.textContent = `+${count}`;\r\n    this.counterElement.title = `${count} √©l√©ment(s) suppl√©mentaire(s)`;\r\n    this.container.appendChild(this.counterElement);\r\n  }\r\n\r\n  canAddMore(): boolean {\r\n    const maxItems = this.config.get('maxItems');\r\n    return !maxItems || this.tags.length < maxItems;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.tags.forEach((tag) => tag.destroy());\r\n    this.tags = [];\r\n    DOMHelpers.removeAllChildren(this.container);\r\n  }\r\n}","import type { ComboSelectConfig, SelectedItem } from '../types/index';\r\nimport { Config } from './Config';\r\nimport { EventEmitter } from './EventEmitter';\r\nimport { DataService } from '@services/DataService';\r\nimport { SearchService } from '@services/SearchService';\r\nimport { RenderService } from '@services/RenderService';\r\nimport { Input } from '@components/Input';\r\nimport { Dropdown } from '@components/Dropdown';\r\nimport { TagList } from '@components/TagList';\r\nimport { DOMHelpers } from '@utils/DOMHelpers';\r\n\r\nexport class ComboSelect {\r\n  private originalInput: HTMLInputElement;\r\n  private config: Config;\r\n  private events: EventEmitter;\r\n  private container: HTMLElement;\r\n  private controlElement: HTMLElement;\r\n  private tagsContainer: HTMLElement;\r\n  private hiddenInput: HTMLInputElement;\r\n  \r\n  // Services\r\n  private dataService: DataService;\r\n  private searchService: SearchService;\r\n  private renderService: RenderService;\r\n  \r\n  // Components\r\n  private input: Input;\r\n  private dropdown: Dropdown;\r\n  private tagList: TagList;\r\n  \r\n  // State\r\n  private isDisabled: boolean;\r\n  private isLoading: boolean;\r\n\r\n  constructor(selector: string, options: Partial<ComboSelectConfig> = {}) {\r\n    const element = document.querySelector(selector);\r\n    \r\n    if (!element || !(element instanceof HTMLInputElement)) {\r\n      throw new Error(`Element \"${selector}\" not found or is not an input element`);\r\n    }\r\n\r\n    this.originalInput = element;\r\n    this.config = new Config(options);\r\n    this.events = new EventEmitter();\r\n    this.isDisabled = false;\r\n    this.isLoading = false;\r\n\r\n    // Initialiser les services\r\n    this.dataService = new DataService(this.config);\r\n    this.searchService = new SearchService(this.config);\r\n    this.renderService = new RenderService(this.config);\r\n\r\n    // Cr√©er la structure DOM\r\n    this.container = this.createContainer();\r\n    this.controlElement = this.createControl();\r\n    this.tagsContainer = this.createTagsContainer();\r\n    this.hiddenInput = this.createHiddenInput();\r\n\r\n    // Initialiser les composants\r\n    this.input = new Input(this.config, this.events);\r\n    this.dropdown = new Dropdown(this.config, this.events, this.renderService);\r\n    this.tagList = new TagList(this.tagsContainer, this.config, this.events, this.renderService);\r\n\r\n    // Assembler le DOM\r\n    this.assemble();\r\n\r\n    // Attacher les √©v√©nements\r\n    this.attachEvents();\r\n\r\n    // Charger CSS personnalis√© si fourni\r\n    this.loadCustomCSS();\r\n\r\n    // Cacher l'input original\r\n    this.originalInput.style.display = 'none';\r\n  }\r\n\r\n  private createContainer(): HTMLElement {\r\n    const container = DOMHelpers.createElement('div', 'comboselect-wrapper');\r\n    return container;\r\n  }\r\n\r\n  private createControl(): HTMLElement {\r\n    const control = DOMHelpers.createElement('div', 'comboselect-control');\r\n    \r\n    control.addEventListener('click', () => {\r\n      if (!this.isDisabled) {\r\n        this.input.focus();\r\n      }\r\n    });\r\n\r\n    return control;\r\n  }\r\n\r\n  private createTagsContainer(): HTMLElement {\r\n    return DOMHelpers.createElement('div', 'comboselect-tags');\r\n  }\r\n\r\n  private createHiddenInput(): HTMLInputElement {\r\n    const input = DOMHelpers.createElement('input', '', {\r\n      type: 'hidden',\r\n      name: this.originalInput.name || '',\r\n    });\r\n    return input;\r\n  }\r\n\r\n  private assemble(): void {\r\n    // Ins√©rer le container apr√®s l'input original\r\n    this.originalInput.parentNode?.insertBefore(this.container, this.originalInput.nextSibling);\r\n\r\n    // Assembler les √©l√©ments\r\n    this.controlElement.appendChild(this.tagsContainer);\r\n    this.controlElement.appendChild(this.input.getElement());\r\n    \r\n    this.container.appendChild(this.controlElement);\r\n    this.container.appendChild(this.dropdown.getElement());\r\n    this.container.appendChild(this.hiddenInput);\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    // √âv√©nement de recherche\r\n    this.events.on('search', async (query: string) => {\r\n      await this.handleSearch(query);\r\n      \r\n      const callback = this.config.get('onSearch');\r\n      if (callback) {\r\n        await callback(query);\r\n      }\r\n    });\r\n\r\n    // √âv√©nement de s√©lection\r\n    this.events.on('select', async (item: SelectedItem) => {\r\n      await this.handleSelect(item);\r\n      \r\n      const callback = this.config.get('onSelect');\r\n      if (callback) {\r\n        await callback(item);\r\n      }\r\n    });\r\n\r\n    // √âv√©nement de suppression\r\n    this.events.on('remove', async (item: SelectedItem) => {\r\n      this.tagList.remove(item);\r\n      this.updateHiddenInput();\r\n      this.input.focus();\r\n      \r\n      const onRemove = this.config.get('onRemove');\r\n      if (onRemove) {\r\n        await onRemove(item);\r\n      }\r\n\r\n      const onChange = this.config.get('onChange');\r\n      if (onChange) {\r\n        await onChange(this.getValue());\r\n      }\r\n    });\r\n\r\n    // √âv√©nements d'ouverture/fermeture\r\n    this.events.on('open', async () => {\r\n      this.input.setAriaExpanded(true);\r\n      \r\n      const callback = this.config.get('onOpen');\r\n      if (callback) {\r\n        await callback();\r\n      }\r\n    });\r\n\r\n    this.events.on('close', async () => {\r\n      this.dropdown.close();\r\n      this.input.setAriaExpanded(false);\r\n      \r\n      const callback = this.config.get('onClose');\r\n      if (callback) {\r\n        await callback();\r\n      }\r\n    });\r\n\r\n    // Fermer le dropdown au clic ext√©rieur\r\n    document.addEventListener('click', (e) => {\r\n      if (!DOMHelpers.isDescendant(this.container, e.target as HTMLElement)) {\r\n        this.dropdown.close();\r\n      }\r\n    });\r\n  }\r\n\r\n  private async handleSearch(query: string): Promise<void> {\r\n\r\n    \r\n    if (this.isLoading) {\r\n\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.isLoading = true;\r\n      this.dropdown.renderLoading();\r\n\r\n  \r\n      const data = await this.dataService.fetch(query);\r\n   \r\n\r\n      const suggestions = this.searchService.parseResults(data);\r\n    \r\n      const filteredSuggestions = this.searchService.filterSelected(\r\n        suggestions,\r\n        this.tagList.getItems()\r\n      );\r\n\r\n      this.dropdown.render(filteredSuggestions);\r\n\r\n      const onLoad = this.config.get('onLoad');\r\n      if (onLoad) {\r\n        await onLoad(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Error during search:', error);\r\n      this.dropdown.render([]);\r\n      \r\n      const onError = this.config.get('onError');\r\n      if (onError && error instanceof Error) {\r\n        await onError(error);\r\n      }\r\n    } finally {\r\n      this.isLoading = false;\r\n\r\n    }\r\n  }\r\n  private async handleSelect(item: SelectedItem): Promise<void> {\r\n    const multiple = this.config.get('multiple');\r\n\r\n    if (!multiple) {\r\n      this.tagList.clear();\r\n    }\r\n\r\n    // V√©rifier si on peut ajouter plus d'items\r\n    if (!this.tagList.canAddMore()) {\r\n      console.warn('Maximum number of items reached');\r\n      return;\r\n    }\r\n\r\n    // MODIFI√â : V√©rifier si l'item existe d√©j√† avant de l'ajouter\r\n    if (this.tagList.hasItem(item)) {\r\n      console.log('Item already selected, skipping:', item);\r\n      // On peut optionnellement afficher un feedback visuel ici\r\n      return;\r\n    }\r\n\r\n    // Ajouter l'item seulement s'il n'existe pas d√©j√†\r\n    const added = this.tagList.add(item);\r\n    \r\n    if (added) {\r\n      this.updateHiddenInput();\r\n\r\n      if (this.config.get('clearOnSelect')) {\r\n        this.input.clear();\r\n      }\r\n\r\n      if (this.config.get('closeOnSelect')) {\r\n        this.dropdown.close();\r\n      }\r\n\r\n      this.input.focus();\r\n\r\n      // Appeler le callback onChange seulement si l'item a √©t√© ajout√©\r\n      const onChange = this.config.get('onChange');\r\n      if (onChange) {\r\n        await onChange(this.getValue());\r\n      }\r\n\r\n      // Appeler onSelect √©galement\r\n      const onSelect = this.config.get('onSelect');\r\n      if (onSelect) {\r\n        await onSelect(item);\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateHiddenInput(): void {\r\n    const items = this.tagList.getItems();\r\n    const values = items.map((item) => item.value);\r\n    this.hiddenInput.value = JSON.stringify(values);\r\n    \r\n    // Mettre √† jour aussi l'input original\r\n    this.originalInput.value = this.hiddenInput.value;\r\n  }\r\n\r\n  private loadCustomCSS(): void {\r\n    const cssUrl = this.config.get('cssUrl');\r\n    if (cssUrl) {\r\n      const link = document.createElement('link');\r\n      link.rel = 'stylesheet';\r\n      link.href = cssUrl;\r\n      document.head.appendChild(link);\r\n    }\r\n  }\r\n\r\n  // Public API\r\n\r\n  public getValue(): SelectedItem[] {\r\n    return this.tagList.getItems();\r\n  }\r\n\r\n  public setValue(items: SelectedItem[]): void {\r\n    this.tagList.clear();\r\n    items.forEach((item) => {\r\n      if (this.tagList.canAddMore()) {\r\n        this.tagList.add(item);\r\n      }\r\n    });\r\n    this.updateHiddenInput();\r\n  }\r\n\r\n  public clear(): void {\r\n    this.tagList.clear();\r\n    this.input.clear();\r\n    this.dropdown.close();\r\n    this.updateHiddenInput();\r\n  }\r\n\r\n  public disable(): void {\r\n    this.isDisabled = true;\r\n    this.input.disable();\r\n    this.controlElement.classList.add('disabled');\r\n    this.dropdown.close();\r\n  }\r\n\r\n  public enable(): void {\r\n    this.isDisabled = false;\r\n    this.input.enable();\r\n    this.controlElement.classList.remove('disabled');\r\n  }\r\n\r\n  public destroy(): void {\r\n    this.dataService.abort();\r\n    this.events.clear();\r\n    this.input.destroy();\r\n    this.dropdown.destroy();\r\n    this.tagList.destroy();\r\n    this.container.remove();\r\n    this.originalInput.style.display = '';\r\n  }\r\n\r\n  public open(): void {\r\n    if (!this.isDisabled) {\r\n      const query = this.input.getValue();\r\n      if (query) {\r\n        void this.handleSearch(query);\r\n      }\r\n    }\r\n  }\r\n\r\n  public close(): void {\r\n    this.dropdown.close();\r\n  }\r\n\r\n  public addItem(item: SelectedItem): void {\r\n    if (this.tagList.canAddMore()) {\r\n      this.tagList.add(item);\r\n      this.updateHiddenInput();\r\n    }\r\n  }\r\n\r\n  public removeItem(item: SelectedItem): void {\r\n    this.tagList.remove(item);\r\n    this.updateHiddenInput();\r\n  }\r\n\r\n  public clearCache(): void {\r\n    this.dataService.clearCache();\r\n  }\r\n}"],"names":["Validators","config","url","_Config","userConfig","__publicField","key","updates","Config","EventEmitter","event","callback","callbacks","args","error","DataService","query","dataSource","data","labelKey","queryLower","item","label","cacheKey","httpMethod","searchParam","headers","fetchUrl","options","separator","response","results","transformResponse","resultsKey","commonKeys","keys","obj","path","current","SearchService","valueKey","value","suggestions","selected","selectedValues","suggestion","DOMHelpers","tag","className","attributes","element","text","div","rect","parent","child","node","RenderService","customRender","debounce","func","wait","timeout","later","Input","events","minChars","expanded","Dropdown","_config","renderService","direction","index","option","e","maxIndex","newIndex","Tag","renderContent","content","removeBtn","TagList","container","existingTagIndex","existingValue","newValue","incrementSize","remainingCount","count","maxItems","ComboSelect","selector","control","onRemove","onChange","filteredSuggestions","onLoad","onError","onSelect","values","cssUrl","link","items"],"mappings":"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"}